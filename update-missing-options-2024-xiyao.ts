import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// 完整的选项数据
const completeOptionsData: Record<number, { options: string[], explanation: string }> = {
  17: {
    options: [
      'A.硫酸氢氯吡格雷',
      'B.华法林片',
      'C.双嘧达莫片',
      'D.西洛他唑片',
      'E.依诺肝素注射液'
    ],
    explanation: '抗凝药物选择预防房颤患者血栓栓塞事件的经典抗凝药物是维生素 K 拮抗剂华法林，其在房颤患者卒中一级与二级预防中的作用已得到多项临床研究肯定。而新型口服抗凝药物(NOAC)有用药方法简单、大出血和致命性出血风险较低等特点。普通肝素或低分子肝素为静脉和皮下用药，一般用于华法林开始前或停用华法林期间的短期替代抗凝治疗。阿司匹林或氯吡格雷预防房颤患者并发卒中的有效性远不如华法林，氯吡格雷与阿司匹林合用减少房颤患者并发卒中和非中枢性血栓栓塞的有效性也不如华法林。因此，不推荐抗血小板药物用于房颤患者血栓栓塞的预防。'
  },
  18: {
    options: [
      'A.注射用阿莫西林克拉维酸钾 1.2gq8h 静脉滴注',
      'B.注射用头孢他啶 1gqd 静脉滴注',
      'C.注射用氨曲南 0.5gq8h 静脉滴注',
      'D.注射用万古霉素 0.5gqod 静脉滴注',
      'E.莫西沙星注射液 0.4gqod 静脉滴注'
    ],
    explanation: '青霉素敏感的肺炎链球菌肺炎的首选治疗是青霉素或阿莫西林。因此，该患者可使用的抗感染治疗方案是 A.注射用阿莫西林克拉维酸钾 1.2gq8h 静脉滴注。头孢他啶是第三代头孢菌素，通常用于对青霉素类药物耐药的感染。氨曲南是单环 β-内酰胺类抗生素，主要针对某些阴性菌。万古霉素是治疗耐甲氧西林金黄色葡萄球菌(MRSA)感染的药物。莫西沙星是氟喹诺酮类抗菌药，虽然对肺炎链球菌敏感，但通常不是首选。'
  },
  27: {
    options: [
      'A.葡萄糖氯化钠注射液的pH范围是3.5-5.5',
      'B.灭菌注射用水的pH范围是3.6-6.5',
      'C.复方氯化钠注射液的pH范围是4.5-7.5',
      'D.0.9%氯化钠注射液的pH范围是4.5-7.0',
      'E.葡萄糖注射液的pH范围是3.2-5.5'
    ],
    explanation: '灭菌注射用水的pH范围应为5.0-7.0。其他选项中提到的pH范围是正确的。'
  },
  31: {
    options: [
      'A.注射用头孢曲松钠',
      'B.匹维溴铵片',
      'C.注射用头孢哌酮舒巴坦钠',
      'D.熊去氧胆酸胶囊',
      'E.异甘草酸镁注射液'
    ],
    explanation: '根据患者的临床表现和实验室检查结果，患者被诊断为急性胆管炎和胆囊炎，伴有胆管结石和胆道完全梗阻。在这种情况下，患者不宜使用的药物是：D.熊去氧胆酸胶囊。熊去氧胆酸胶囊主要用于胆汁淤积性肝病患者的治疗，但对于胆道完全阻塞的患者是禁用的。这是因为熊去氧胆酸胶囊在胆道完全阻塞的情况下无法通过胆道排泄，可能会加重患者的病情。而其他选项中的药物，如头孢曲松钠、头孢哌酮舒巴坦钠和异甘草酸镁注射液，都是用于抗感染和保肝治疗的药物，对于胆道感染和肝损伤的患者是适用的。匹维溴铵片是一种解痉药，可以用于缓解胆道痉挛引起的疼痛。因此，根据患者的病情和药物的适应症，熊去氧胆酸胶囊是不宜使用的药物。'
  },
  33: {
    options: [
      'A.阿达木单抗注射液 40mg，每两周一次皮下注射',
      'B.来氟米特片 200mgbid，口服',
      'C.英夫利西单抗注射液 3mg/kg，一周一次皮下注射',
      'D.依那西普注射液 25mg 每周 2 次，皮下注射',
      'E.托法替布片 5mgbid 口服'
    ],
    explanation: '英夫利西单抗注射液的推荐剂量为首次给予 3mg/kg，然后在首次给药后的第 2 周和第 6 周，相当于 0,2,6 周各一次，之后每 8 周给药一次。因此，选项 C 中提到的"一周一次皮下注射"是不正确的给药方案。'
  },
  36: {
    options: [
      'A.继续口服甲硫咪唑片10mgd',
      'B.停用甲硫咪唑片，改为口服丙硫氧嘧啶片100mgd',
      'C.将甲硫咪唑片剂量调整为10mgd',
      'D.为防止甲亢对胎儿影响，立即行131I治疗',
      'E.为防止甲亢对胎儿影响，立即行甲状腺手术治疗'
    ],
    explanation: '特别是孕早期，推荐使用丙硫氧嘧啶（PTU）作为甲亢的一线治疗药物，因为甲硫咪唑（MMI）有潜在的致畸风险，可能会导致胎儿发育畸形，如皮肤发育不全和"甲硫咪唑相关的胚胎病"，包括鼻后孔和食管的闭锁、颜面畸形等。因此，一旦确诊妊娠，建议停用甲硫咪唑，并改用丙硫氧嘧啶进行治疗。'
  },
  91: {
    options: [
      'A.静脉滴注5-单硝酸异山梨酯注射液',
      'B.口服比索洛尔片',
      'C.顿服负荷剂量的硫酸氢氯吡格雷片',
      'D.静脉注射负荷剂量的普通肝素后，持续静脉滴注',
      'E.顿服负荷剂量的阿司匹林肠溶片'
    ],
    explanation: '对于非ST段抬高型心肌梗死（NSTEMI）患者，硝酸酯类药物是首选抗心肌缺血的血管扩张剂，可以用于缓解心绞痛症状。但是，对于该患者而言，由于他近期出现胸痛且含服硝酸甘油无效，表明病情可能较为严重，单一使用硝酸酯类药物可能不足以控制症状，因此选项A不是最佳选择。'
  },
  94: {
    options: [
      'A.噻托溴铵干粉吸入剂，1 天 1 次，一次 1 吸',
      'B.沙丁胺醇气雾剂，按需使用',
      'C.特布他林溶液，1 天 3 次，雾化吸入',
      'D.异丙托溴铵气雾剂，一天 3 次，一次 1 吸',
      'E.布地奈德溶液，一天 2 次，雾化吸入'
    ],
    explanation: '该患者全面症状评估结果 CAT20 分，MRC2 级，稳定期宜使用的维持治疗方案是考虑到患者的 CAT 评分和 MRC 等级，表明患者的症状和活动受限程度，需要一个能够有效改善症状和生活质量的治疗方案。噻托溴铵是一种长效抗胆碱能药物，适用于 COPD 的长期维持治疗。因此，正确答案为：A.噻托溴铵干粉吸入剂，1 天 1 次，一次 1 吸。'
  },
  101: {
    options: [
      'A.通常抗感染治疗结束后无需进行咽拭子检查',
      'B.急性扁桃体炎常由细菌感染所致，是一种自限性疾病',
      'C.应按规定流程给药，避免出现全身并发症并诱导细菌耐药',
      'D.用药 48 小时后，如症状未明显改变应及时就诊评估',
      'E.一年内发生五次以上扁桃体炎，可考虑外科手术'
    ],
    explanation: '如果已经使用一周的抗菌药物，而症状未改善，应及时就诊评估。'
  },
  104: {
    options: [
      'A.维拉帕米片',
      'B.胺碘酮片',
      'C.左西孟旦注射液',
      'D.比索洛尔片',
      'E.地尔硫卓片'
    ],
    explanation: '在心力衰竭的治疗中，β受体拮抗剂是改善预后的重要药物，可以降低心率，减轻心脏的负担。比索洛尔是一种选择性的β1受体拮抗剂，适用于心力衰竭患者的长期治疗。因此，正确答案是：D.比索洛尔片。'
  },
  106: {
    options: [
      'A.辛伐他汀片剂量调整为80mgqd',
      'B.维持现有调脂治疗方案',
      'C.换用依折麦布片10mgqd降脂治疗',
      'D.换用阿托伐他汀钙片20mgqd降脂治疗',
      'E.加用非诺贝特胶囊200mgqd'
    ],
    explanation: '辛伐他汀和阿托伐他汀都属于他汀类药物，但阿托伐他汀的降脂效果更强，适用于需要更强效降低LDL-C的患者。如果辛伐他汀的治疗效果不佳，可以考虑更换为阿托伐他汀。'
  },
  110: {
    options: [
      'A.使用糖皮质激素对受压迫神经根进行神经阻滞',
      'B.颈部外用氟比洛芬凝胶贴',
      'C.短期按需服用氨酚羟考酮片',
      'D.按时静脉推注吗啡注射液',
      'E.使用中枢性肌松药缓解肩背部肌肉僵硬'
    ],
    explanation: '吗啡是一种阿片类药物，通常不推荐用于慢性疼痛治疗，因为它具有成瘾性，并且长期使用可能导致耐受性和依赖性。'
  }
};

async function updateOptions() {
  try {
    console.log('🔧 开始更新12道题的完整选项和解析...\n');

    const questions = await prisma.questions.findMany({
      where: {
        source_year: 2024,
        subject: '药学综合知识与技能'
      },
      orderBy: {
        created_at: 'asc'
      }
    });

    let successCount = 0;
    let failCount = 0;

    for (const [questionNum, data] of Object.entries(completeOptionsData)) {
      const index = parseInt(questionNum) - 1;
      
      try {
        if (questions[index]) {
          await prisma.questions.update({
            where: { id: questions[index].id },
            data: {
              options: data.options,
              ai_explanation: data.explanation
            }
          });
          
          console.log(`✅ 题${questionNum}: 已更新选项和解析`);
          successCount++;
        } else {
          console.log(`❌ 题${questionNum}: 未找到对应题目`);
          failCount++;
        }
      } catch (error) {
        console.error(`❌ 题${questionNum}: 更新失败 -`, error);
        failCount++;
      }
    }

    console.log('\n' + '='.repeat(60));
    console.log('📊 更新统计');
    console.log('='.repeat(60));
    console.log(`成功: ${successCount}道 ✅`);
    console.log(`失败: ${failCount}道 ❌`);
    console.log('='.repeat(60));

    if (successCount === 12) {
      console.log('\n🎉 所有题目更新成功！');
    }

  } catch (error) {
    console.error('❌ 更新失败:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

updateOptions();
