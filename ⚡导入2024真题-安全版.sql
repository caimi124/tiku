-- ========================================
-- 2024年执业药师 中药学综合知识与技能 真题导入
-- 安全版：自动处理冲突（存在则跳过，不存在则插入）
-- ========================================

-- 使用 ON CONFLICT DO NOTHING 避免重复插入错误
INSERT INTO questions (
  id, exam_type, subject, chapter, question_type, 
  content, options, correct_answer, explanation, 
  difficulty, knowledge_points, source_type, source_year, is_published
) VALUES

-- 第1题
('2024_zyyz_001', '执业药师', '中药学综合知识与技能', '中医基础理论', 'single', 
'属于"阳脉之海"的是', 
'[{"key":"A","value":"阳维之脉"},{"key":"B","value":"阳跷之脉"},{"key":"C","value":"督脉"},{"key":"D","value":"带脉"},{"key":"E","value":"任脉"}]'::jsonb,
'C', '督脉为"阳脉之海"。任脉为"阴脉之海"。', 
2, ARRAY['经络学说', '高频考点', '2024年真题'], '真题', 2024, true),

-- 第2题
('2024_zyyz_002', '执业药师', '中药学综合知识与技能', '中药贮藏与养护', 'single',
'《中国药典》"凡例"中贮藏项下各名词术语进行了解释，关于中药贮藏名词说法，正确的是',
'[{"key":"A","value":"密封系指将容器密闭，以防止尘及异物进入"},{"key":"B","value":"遮光系指避免日光直射"},{"key":"C","value":"阴凉处系指不超过20°C的环境"},{"key":"D","value":"冷处系指0~8°C的环境"},{"key":"E","value":"常温系指10~25°C的环境"}]'::jsonb,
'C', '阴凉处系指不超过20°C的环境。密封是指将容器密闭，以防止风化、吸潮、挥发或异物进入。', 
2, ARRAY['中药贮藏', '药典', '2024年真题'], '真题', 2024, true),

-- 第3题
('2024_zyyz_003', '执业药师', '中药学综合知识与技能', '中医诊断', 'single',
'舌苔黄腻，多见于',
'[{"key":"A","value":"寒湿证"},{"key":"B","value":"湿热证"},{"key":"C","value":"痰饮证"},{"key":"D","value":"血瘀证"},{"key":"E","value":"气滞证"}]'::jsonb,
'B', '舌苔黄腻，多见于湿热证。苔黄示热，苔腻示湿或痰浊、食积。', 
2, ARRAY['舌诊', '望诊', '2024年真题'], '真题', 2024, true),

-- 第4题
('2024_zyyz_004', '执业药师', '中药学综合知识与技能', '中药注射剂使用', 'single',
'关于中药注射剂临床使用原则的说法，错误的是',
'[{"key":"A","value":"能口服给药的，不选用注射给药"},{"key":"B","value":"能肌内注射给药的，不选用静脉注射或滴注给药"},{"key":"C","value":"能单独使用的，不与其他药品混合使用"},{"key":"D","value":"应先做皮试，无过敏反应方可使用"},{"key":"E","value":"严格按照药品说明书规定的功能主治使用"}]'::jsonb,
'D', '中药注射剂一般不需要皮试，但应注意过敏反应。D选项说法错误。', 
3, ARRAY['中药注射剂', '用药安全', '2024年真题'], '真题', 2024, true),

-- 第5题
('2024_zyyz_005', '执业药师', '中药学综合知识与技能', '感冒用药', 'single',
'某男，28岁。恶寒重，发热轻，无汗，头痛，肢体酸痛，鼻塞流清涕，咳嗽痰白清稀。治疗宜选用的中成药是',
'[{"key":"A","value":"桑菊感冒颗粒"},{"key":"B","value":"双黄连口服液"},{"key":"C","value":"感冒清热颗粒"},{"key":"D","value":"银翘解毒片"},{"key":"E","value":"羚翘解毒丸"}]'::jsonb,
'C', '辨证为风寒感冒，治疗宜选用感冒清热颗粒。桑菊感冒颗粒、双黄连口服液、银翘解毒片、羚翘解毒丸都用于风热感冒。', 
2, ARRAY['感冒', '辨证施治', '2024年真题'], '真题', 2024, true),

-- 第6题
('2024_zyyz_006', '执业药师', '中药学综合知识与技能', '中药饮片炮制', 'single',
'处方开具"炒白术"，应调配',
'[{"key":"A","value":"生白术"},{"key":"B","value":"土炒白术"},{"key":"C","value":"麸炒白术"},{"key":"D","value":"焦白术"},{"key":"E","value":"白术炭"}]'::jsonb,
'C', '处方直接写"炒某药"，一般调配麸炒品。炒白术应调配麸炒白术。', 
3, ARRAY['中药炮制', '饮片调剂', '2024年真题'], '真题', 2024, true),

-- 第7题
('2024_zyyz_007', '执业药师', '中药学综合知识与技能', '中西药联用', 'single',
'关于中西药联用的说法，错误的是',
'[{"key":"A","value":"含麻黄的中成药不宜与降压药联用"},{"key":"B","value":"含甘草的中成药不宜与强心苷类药联用"},{"key":"C","value":"含鞣质的中药不宜与抗生素联用"},{"key":"D","value":"含钙的中成药可与四环素类抗生素联用"},{"key":"E","value":"含有机酸的中药不宜与碱性西药联用"}]'::jsonb,
'D', '含钙的中成药不宜与四环素类抗生素联用，因为钙离子可与四环素类药物形成络合物，降低其吸收。D选项说法错误。', 
3, ARRAY['中西药联用', '用药安全', '2024年真题'], '真题', 2024, true),

-- 第8题
('2024_zyyz_008', '执业药师', '中药学综合知识与技能', '中成药', 'single',
'某女，35岁。月经量少，色淡，质稀，小腹隐痛，头晕眼花，心悸失眠，面色萎黄，舌淡苔薄，脉细。治疗宜选用的中成药是',
'[{"key":"A","value":"当归丸"},{"key":"B","value":"益母草颗粒"},{"key":"C","value":"调经活血片"},{"key":"D","value":"八珍益母丸"},{"key":"E","value":"逍遥丸"}]'::jsonb,
'D', '辨证为气血两虚证，治疗宜选用八珍益母丸。', 
3, ARRAY['月经病', '辨证施治', '2024年真题'], '真题', 2024, true),

-- 第9题
('2024_zyyz_009', '执业药师', '中药学综合知识与技能', '合理用药', 'single',
'某女，60岁。患有高血压病，规律服用缬沙坦，血压控制良好。近日因咽喉肿痛自购六神丸服用，服药后出现心律失常。最可能的原因是',
'[{"key":"A","value":"六神丸与缬沙坦发生药物相互作用"},{"key":"B","value":"六神丸中的蟾酥引起心脏毒性"},{"key":"C","value":"缬沙坦引起低钾血症导致心律失常"},{"key":"D","value":"患者对六神丸过敏"},{"key":"E","value":"六神丸加重高血压引起心律失常"}]'::jsonb,
'B', '六神丸含有蟾酥，蟾酥有强心作用，但过量或久服可引起心律失常等心脏毒性反应。', 
4, ARRAY['用药安全', '毒性药物', '2024年真题'], '真题', 2024, true),

-- 第10题
('2024_zyyz_010', '执业药师', '中药学综合知识与技能', '中医诊断', 'single',
'患者面色淡白，唇舌色淡，多见于',
'[{"key":"A","value":"气虚证"},{"key":"B","value":"血虚证"},{"key":"C","value":"阳虚证"},{"key":"D","value":"阴虚证"},{"key":"E","value":"血瘀证"}]'::jsonb,
'B', '面色淡白或萎黄，唇舌色淡，多见于血虚证。', 
2, ARRAY['望诊', '面色', '2024年真题'], '真题', 2024, true)

-- 🔥 关键：遇到冲突时跳过，不报错
ON CONFLICT (id) DO NOTHING;

-- 统计导入结果
DO $$
DECLARE
  v_total INTEGER;
  v_2024 INTEGER;
BEGIN
  SELECT 
    COUNT(*),
    COUNT(*) FILTER (WHERE source_year = 2024)
  INTO v_total, v_2024
  FROM questions
  WHERE subject = '中药学综合知识与技能';
  
  RAISE NOTICE '========================================';
  RAISE NOTICE '✅ 导入完成（安全模式）';
  RAISE NOTICE '========================================';
  RAISE NOTICE '';
  RAISE NOTICE '导入说明：';
  RAISE NOTICE '  - 已存在的题目自动跳过';
  RAISE NOTICE '  - 新题目成功插入';
  RAISE NOTICE '  - 不会出现重复错误';
  RAISE NOTICE '';
  RAISE NOTICE '当前统计：';
  RAISE NOTICE '  题库总数: % 道', v_total;
  RAISE NOTICE '  2024年真题: % 道', v_2024;
  RAISE NOTICE '';
  RAISE NOTICE '========================================';
END $$;

-- 查看2024年真题
SELECT 
  '2024年真题统计' as 说明,
  COUNT(*) as 总数,
  COUNT(*) FILTER (WHERE question_type = 'single') as 单选题,
  COUNT(*) FILTER (WHERE question_type = 'multiple') as 多选题
FROM questions
WHERE source_year = 2024 AND subject = '中药学综合知识与技能';
