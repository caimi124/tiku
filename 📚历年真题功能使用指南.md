# 📚 历年真题功能使用指南

## 🎯 功能概述

历年真题功能允许用户按年份查看和练习历年考试真题，帮助把握考试方向和命题规律。

---

## ✅ 功能特点

### 1. 按年份分类
- 2024年真题：120道题
- 2023年真题：120道题
- 更多年份持续更新

### 2. 详细统计
- 每年题目总数
- 完成进度追踪
- 正确率统计
- 答题时间记录

### 3. 智能练习
- 顺序练习模式
- 题目导航功能
- 答案解析展示
- 错题标记收藏

### 4. 模拟考试
- 按年份进行模拟考试
- 限时答题
- 成绩评估

---

## 🚀 使用步骤

### 第1步：更新数据库结构

在 Supabase Dashboard SQL Editor 中运行：

```bash
# 文件：数据库更新-添加历年真题字段.sql
```

执行后会添加：
- `source_type` 字段：标识题目来源类型
- `source_year` 字段：标识题目年份
- 相关索引：提高查询性能

### 第2步：导入真题数据

#### 导入2024年真题
```bash
# 文件：⚡导入2024真题-快速脚本.sql
```

#### 导入2023年真题
```bash
# 文件：导入2023年中药药综真题.sql
```

### 第3步：访问历年真题

启动开发服务器：
```bash
npm run dev
```

访问路径：
```
http://localhost:3000/practice
```

点击"历年真题"卡片进入。

---

## 📱 页面结构

### 1. 练习模式首页 (`/practice`)

显示所有练习模式，包括：
- 章节练习
- **历年真题** ⭐（新增）
- 随机练习
- 专项突破
- 每日一练
- 模拟考试

### 2. 历年真题列表 (`/practice/history`)

展示内容：
- 年份列表（2024、2023、2022...）
- 每年题目数量
- 完成进度统计
- 正确率展示

操作按钮：
- **开始练习**：顺序做题
- **模拟考试**：限时考试模式

### 3. 年份练习页 (`/practice/history/[year]`)

功能包括：
- 题目内容展示
- 选项选择
- 答案提交
- 解析查看
- 题目导航
- 进度追踪

导航功能：
- 上一题 / 下一题
- 题号快速跳转
- 已答题状态标记（正确/错误）

---

## 🔍 API接口

### 获取历年真题

**请求示例：**
```typescript
// 获取2024年真题
fetch('/api/questions?sourceYear=2024&subject=中药学综合知识与技能&limit=200')
  .then(res => res.json())
  .then(data => {
    console.log(data.data.questions);
  });
```

**支持参数：**
- `sourceYear`: 年份（2024、2023等）
- `subject`: 科目
- `examType`: 考试类型
- `chapter`: 章节
- `limit`: 数量限制
- `offset`: 偏移量

**返回数据：**
```json
{
  "success": true,
  "data": {
    "questions": [
      {
        "id": "2024_zyyz_001",
        "content": "题目内容...",
        "options": [
          {"key": "A", "value": "选项A"},
          {"key": "B", "value": "选项B"}
        ],
        "correctAnswer": "A",
        "explanation": "解析内容...",
        "sourceYear": 2024,
        "sourceType": "真题"
      }
    ],
    "total": 120,
    "limit": 200,
    "offset": 0
  }
}
```

---

## 📊 数据库结构

### questions 表新增字段

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| source_type | TEXT | 来源类型 | "真题"/"模拟题"/"练习题" |
| source_year | INTEGER | 来源年份 | 2024, 2023 |

### 索引

```sql
-- 单字段索引
CREATE INDEX idx_questions_source_year ON questions(source_year);

-- 复合索引
CREATE INDEX idx_questions_source_year_subject ON questions(source_year, subject);
```

---

## 💡 使用技巧

### 1. 练习建议

**新手：**
- 从最新年份（2024）开始
- 先做章节熟悉的题目
- 查看答案解析理解考点

**进阶：**
- 按年份倒序练习（2024→2023→2022）
- 标记错题反复练习
- 总结高频考点

**冲刺：**
- 完成所有年份真题
- 进行限时模拟考试
- 重点攻克薄弱章节

### 2. 时间规划

- **每天30分钟**：完成15-20道题
- **每周2小时**：完成一年真题（120题）
- **考前1个月**：完成所有历年真题

### 3. 错题管理

- 标记不会的题目
- 收藏到错题本
- 定期复习巩固

---

## 🎨 前端组件

### 历年真题列表页面

**文件：** `app/practice/history/page.tsx`

**功能：**
- 展示所有年份
- 统计数据显示
- 年份卡片展示
- 进度可视化

### 年份练习页面

**文件：** `app/practice/history/[year]/page.tsx`

**功能：**
- 题目展示
- 答案选择
- 解析查看
- 进度追踪
- 题目导航

---

## 🔧 开发说明

### 1. 添加新年份真题

**步骤：**
1. 准备题目数据（Excel/JSON）
2. 转换为SQL INSERT语句
3. 设置 `source_year` 和 `source_type`
4. 在Supabase SQL Editor执行

**SQL模板：**
```sql
INSERT INTO questions (
  id, exam_type, subject, chapter, 
  question_type, content, options, 
  correct_answer, explanation, 
  difficulty, knowledge_points, 
  source_type, source_year
) VALUES (
  '2025_zyyz_001',
  '执业药师',
  '中药学综合知识与技能',
  '中医基础理论',
  'single',
  '题目内容...',
  '[{"key":"A","value":"选项A"}]'::jsonb,
  'A',
  '解析内容...',
  2,
  ARRAY['知识点1', '2025年真题'],
  '真题',
  2025
);
```

### 2. 前端修改

如需修改年份列表，编辑：
```typescript
// app/practice/history/page.tsx

const mockData: YearData[] = [
  {
    year: 2025, // 新增年份
    totalQuestions: 120,
    completedQuestions: 0,
    correctRate: 0,
    subjects: [
      { name: "中药学综合知识与技能", count: 120 },
    ],
  },
  // ... 其他年份
];
```

### 3. API扩展

如需支持更多筛选条件，修改：
```typescript
// app/api/questions/route.ts

const sourceType = searchParams.get("sourceType");
if (sourceType) where.sourceType = sourceType;
```

---

## 📈 数据统计查询

### 查看各年份题目数量
```sql
SELECT 
  source_year as 年份,
  COUNT(*) as 题目数,
  COUNT(DISTINCT chapter) as 章节数
FROM questions
WHERE source_type = '真题'
GROUP BY source_year
ORDER BY source_year DESC;
```

### 查看题型分布
```sql
SELECT 
  source_year as 年份,
  question_type as 题型,
  COUNT(*) as 数量
FROM questions
WHERE source_type = '真题'
GROUP BY source_year, question_type
ORDER BY source_year DESC, question_type;
```

### 查看章节分布
```sql
SELECT 
  chapter as 章节,
  COUNT(*) as 题目数
FROM questions
WHERE source_year = 2024
GROUP BY chapter
ORDER BY COUNT(*) DESC;
```

---

## ❓ 常见问题

### Q1: 为什么看不到某年的真题？

**A:** 检查以下几点：
1. 数据库是否已导入该年份数据
2. `source_year` 字段是否正确设置
3. API查询参数是否正确

**验证方法：**
```sql
SELECT COUNT(*) FROM questions WHERE source_year = 2024;
```

### Q2: 如何批量导入题目？

**A:** 推荐方式：
1. 使用SQL脚本（推荐）- 参考现有导入脚本
2. 使用Supabase Table Editor的Import功能
3. 使用API批量创建

### Q3: 题目显示顺序如何控制？

**A:** 
- 默认按创建时间排序
- 可在API中修改 `orderBy` 参数
- 前端可实现自定义排序

### Q4: 如何实现限时模拟考试？

**A:** 
- 创建 `/practice/history/[year]/mock` 路由
- 添加倒计时功能
- 限制题目跳转
- 时间结束自动提交

---

## 🎯 下一步计划

### 功能增强
- [ ] 添加更多年份真题（2022、2021...）
- [ ] 实现模拟考试模式
- [ ] 添加答题统计图表
- [ ] 支持题目收藏和标记
- [ ] 错题本集成

### 性能优化
- [ ] 题目数据缓存
- [ ] 分页加载优化
- [ ] 图片懒加载

### 用户体验
- [ ] 答题进度自动保存
- [ ] 支持快捷键操作
- [ ] 移动端优化

---

## 📞 技术支持

遇到问题？
1. 查看控制台错误信息
2. 检查Supabase日志
3. 验证API响应数据
4. 查看浏览器Network面板

**快速测试：**
```bash
# 测试API连接
npx tsx test-api-connection.ts

# 查看数据库数据
# 访问 Supabase Dashboard → Table Editor → questions
```

---

## ✅ 功能清单

- [x] 数据库字段添加（source_type, source_year）
- [x] API支持按年份筛选
- [x] 历年真题列表页面
- [x] 年份练习页面
- [x] 题目导航功能
- [x] 答案解析展示
- [x] 进度追踪统计
- [x] 2024年真题导入脚本
- [x] 2023年真题导入脚本
- [ ] 模拟考试模式（待开发）
- [ ] 答题数据统计（待开发）

---

**🎉 现在你可以开始使用历年真题功能了！**

建议步骤：
1. 运行数据库更新脚本
2. 导入2024和2023年真题
3. 启动开发服务器测试
4. 开始刷题！💪
