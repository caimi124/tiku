# 历年真题显示修复方案

## 问题诊断

1. **前端页面**: `/materials` 使用模拟数据，不连接数据库
2. **历年真题页面**: `/practice/history` 连接数据库但查询不到数据
3. **数据库**: 120道2024年真题可能未正确导入

## 解决方案

### 方案1：通过Supabase SQL Editor导入（推荐 - 最快）

1. 登录 Supabase: https://supabase.com/dashboard
2. 选择项目 `tiku2`
3. 进入 **SQL Editor**
4. 执行以下SQL（示例前5题）：

```sql
-- 插入2024年执业药师中药学综合知识与技能真题
INSERT INTO public.questions (
  exam_type, subject, chapter, question_type, content, options, 
  correct_answer, explanation, difficulty, knowledge_points, 
  source_type, source_year, is_published
) VALUES
-- 第1题
('执业药师', '中药学综合知识与技能', '中医基础理论', 'single', 
'属于"阳脉之海"的是',
'{"A": "阳维之脉", "B": "阳跷之脉", "C": "督脉", "D": "带脉", "E": "任脉"}'::jsonb,
'C', '督脉为"阳脉之海"。任脉为"阴脉之海"。', 2,
'{"经络学说", "奇经八脉"}'::text[], '历年真题', 2024, true),

-- 第2题
('执业药师', '中药学综合知识与技能', '中药贮藏', 'single',
'《中国药典》"凡例"中贮藏项下各名词术语进行了解释，关于中药贮藏名词说法，正确的是',
'{"A": "密封系指将容器密闭，以防止尘及异物进入", "B": "遮光系指避免日光直射", "C": "阴凉处系指不超过20°C的环境", "D": "冷处系指0~8°C的环境", "E": "常温系指10~25°C的环境"}'::jsonb,
'C', '阴凉处系指不超过20°C的环境，选项C说法正确。', 2,
'{"中药贮藏", "药典知识"}'::text[], '历年真题', 2024, true),

-- 第3题
('执业药师', '中药学综合知识与技能', '中医药学发展史', 'single',
'由唐代孙思邈撰著，在序例中著有"大医习业""大医精诚"两篇专论的典籍是',
'{"A": "《外台秘要》", "B": "《巢氏病源》", "C": "《千金要方》", "D": "《千金翼方》", "E": "《新修本草》"}'::jsonb,
'C', '在序例中著有"大医习业""大医精诚"两篇专论的典籍是《千金要方》。', 1,
'{"中医典籍", "孙思邈"}'::text[], '历年真题', 2024, true),

-- 第4题
('执业药师', '中药学综合知识与技能', '痹证辨治', 'single',
'某女，40岁，肢体肌肉酸楚、重着，疼痛，肿胀，活动不利，口中黏腻，舌苔白腻，脉濡缓。治疗宜的基础方剂是',
'{"A": "薏苡仁汤", "B": "独活寄生汤", "C": "乌头汤", "D": "桃红饮", "E": "防风汤"}'::jsonb,
'A', '依据关键词重着，舌苔白腻，辨证有湿邪痹症，故选用薏苡仁汤。', 2,
'{"痹证", "湿邪", "方剂应用"}'::text[], '历年真题', 2024, true),

-- 第5题
('执业药师', '中药学综合知识与技能', '中药注射剂使用', 'single',
'关于中药注射剂使用原则的说法，错误的是',
'{"A": "中药注射剂和其他药品一起混合滴注", "B": "应密切观察用药反应，特别是用药后30分钟内", "C": "按照药品说明书推荐的剂量给药速度和疗程使用", "D": "临床使用中药注射剂应辨证用药", "E": "选用中药注射剂应合理选择给药途径"}'::jsonb,
'A', '中药注射剂应该单独滴注，故A说法错误。', 1,
'{"中药注射剂", "用药安全"}'::text[], '历年真题', 2024, true);
```

5. **验证导入**:
```sql
SELECT count(*) as total_questions 
FROM public.questions 
WHERE source_year = 2024 
AND subject = '中药学综合知识与技能';
```

### 方案2：访问历年真题页面

导入完成后，访问：
- **历年真题列表**: https://yikaobiguo.com/practice/history
- **2024年真题练习**: https://yikaobiguo.com/practice/history/2024

## 关键修复

### 1. 数据库字段映射
确保导入时字段名正确：
- `exam_type` (不是 examType)
- `source_year` (不是 sourceYear)
- `source_type` (不是 sourceType)
- `question_type` (不是 questionType)
- `knowledge_points` (不是 knowledgePoints)
- `correct_answer` (不是 correctAnswer)

### 2. Options字段格式
Options必须是JSONB格式：
```json
{
  "A": "选项A内容",
  "B": "选项B内容",
  "C": "选项C内容",
  "D": "选项D内容",
  "E": "选项E内容"
}
```

### 3. Knowledge Points字段格式
Knowledge points必须是文本数组：
```sql
'{"知识点1", "知识点2", "知识点3"}'::text[]
```

## 页面访问路径

1. **首页** → "历年真题" 按钮
2. **练习页面** (`/practice`) → "历年真题"卡片
3. **直接访问** `/practice/history`

## 完整的120题SQL文件

如果需要导入全部120题，请使用文件：
- `03-导入2024年中药药综真题-完整版.sql`

或者联系我生成完整的PostgreSQL导入SQL。

## 测试验证

导入后执行测试：
```sql
-- 1. 检查总数
SELECT count(*) FROM questions WHERE source_year = 2024;

-- 2. 按章节统计
SELECT chapter, count(*) as count 
FROM questions 
WHERE source_year = 2024 
GROUP BY chapter 
ORDER BY count DESC;

-- 3. 查看前5题
SELECT id, content, correct_answer 
FROM questions 
WHERE source_year = 2024 
LIMIT 5;
```

## 预期结果

导入成功后：
- ✅ 历年真题页面显示 "2024年" 卡片
- ✅ 显示 "120 道题"
- ✅ 点击"开始练习"可以做题
- ✅ materials 页面会显示历年真题资料（如果配置了PDF资源）
