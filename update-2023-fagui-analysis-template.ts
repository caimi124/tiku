import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// ğŸ“ åœ¨è¿™é‡Œæ·»åŠ ç¼ºå¤±çš„è§£æå†…å®¹
// æ ¼å¼: é¢˜å· -> è§£æå†…å®¹
const MISSING_ANALYSIS: Record<number, string> = {
  // é¢˜38: å›½å®¶é‡ç‚¹ç›‘æ§åˆç†ç”¨è¯è¯å“ç›®å½•
  38: 'çº³å…¥ç›®å½•ç®¡ç†çš„è¯å“åº”å½“æ˜¯ä¸´åºŠä½¿ç”¨ä¸åˆç†é—®é¢˜è¾ƒå¤šã€ä½¿ç”¨é‡‘é¢å¼‚å¸¸åé«˜ã€å¯¹ç”¨è¯åˆç†æ€§å½±å“è¾ƒå¤§çš„åŒ–å­¦è¯å“å’Œç”Ÿç‰©åˆ¶å“ã€‚é‡ç‚¹åŒ…æ‹¬è¾…åŠ©ç”¨è¯ã€æŠ—è‚¿ç˜¤è¯ç‰©ã€æŠ—å¾®ç”Ÿç‰©è¯ç‰©ã€è´¨å­æ³µæŠ‘åˆ¶å‰‚ã€ç³–çš®è´¨æ¿€ç´ ã€è‚ å¤–è¥å…»è¯ç‰©ç­‰ã€‚ç›®å½•ç®¡ç†èŒƒå›´ä¸»è¦é’ˆå¯¹åŒ–å­¦è¯å“å’Œç”Ÿç‰©åˆ¶å“ï¼Œå¹¶æœªå°†ä¸­è¯é¥®ç‰‡å’Œä¸­æˆè¯çº³å…¥ï¼Œå› æ­¤Dé€‰é¡¹è¯´æ³•é”™è¯¯ã€‚',
  
  // é¢˜101: å‡ç–«è‹—å¤„ç½š
  101: 'æ ¹æ®ã€Šç–«è‹—ç®¡ç†æ³•ã€‹ï¼Œæ¥ç§å•ä½æ¥ç§å‡ç–«è‹—çš„ï¼Œç”±å¿çº§ä»¥ä¸Šäººæ°‘æ”¿åºœè¯å“ç›‘ç£ç®¡ç†éƒ¨é—¨æ²¡æ”¶è¿æ³•æ‰€å¾—å’Œè¿æ³•æŒæœ‰çš„ç–«è‹—ï¼Œè´£ä»¤åœä¸šæ•´é¡¿ï¼Œå¹¶å¤„è¿æ³•æŒæœ‰ç–«è‹—è´§å€¼é‡‘é¢åäº”å€ä»¥ä¸Šäº”åå€ä»¥ä¸‹çš„ç½šæ¬¾ï¼Œè´§å€¼é‡‘é¢ä¸è¶³äº”åä¸‡å…ƒçš„ï¼ŒæŒ‰äº”åä¸‡å…ƒè®¡ç®—ï¼›æƒ…èŠ‚ä¸¥é‡çš„ï¼ŒåŠé”€æ¥ç§å•ä½çš„æ¥ç§èµ„æ ¼ï¼Œç”±åŸå‘è¯éƒ¨é—¨åŠé”€è´Ÿæœ‰è´£ä»»çš„åŒ»ç–—å«ç”Ÿäººå‘˜çš„æ‰§ä¸šè¯ä¹¦ã€‚æœ¬é¢˜ä¸­ï¼Œç–«è‹—Cç»è®¤å®šä¸ºå‡ç–«è‹—ï¼Œè´§å€¼é‡‘é¢ä¸º12ä¸‡å…ƒï¼Œä¸è¶³50ä¸‡å…ƒï¼ŒæŒ‰50ä¸‡å…ƒè®¡ç®—ã€‚ç½šæ¬¾å¹…åº¦ä¸º15å€è‡³50å€ï¼Œå³750ä¸‡å…ƒè‡³2500ä¸‡å…ƒã€‚é€‰é¡¹Dï¼ˆ750ä¸‡å…ƒï¼‰å¤„äºç½šæ¬¾åŒºé—´çš„ä¸‹é™ï¼Œä¸”åŒ…å«å–æ¶ˆæ¥ç§èµ„æ ¼ï¼Œç¬¦åˆè§„å®šã€‚',
  
  // é¢˜102: å«å…´å¥‹å‰‚å¤„æ–¹è¯
  102: 'æ ¹æ®æ¡ˆä¾‹èƒŒæ™¯ææ–™ä¸­æåŠçš„"æœ¬å“å«xx"ä»¥åŠ"ä¸å¯è¶…å‰‚é‡æˆ–é•¿æœŸæœç”¨"çš„è­¦ç¤ºè¯­ï¼Œç»“åˆé¢˜ç›®ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥æ¨æ–­è¯¥è¯å“æœ€å¯èƒ½å±äºéœ€è¦ç‰¹åˆ«ç®¡ç†ã€å¯èƒ½è¢«æ»¥ç”¨çš„è¯ç‰©ï¼Œå› æ­¤å«å…´å¥‹å‰‚çš„å¤„æ–¹è¯å¯èƒ½æ€§æœ€å¤§ã€‚',
  
  // é¢˜104: è¯´æ˜ä¹¦ã€ç¦å¿Œã€‘é¡¹
  104: 'æ ¹æ®æ¡ˆä¾‹èƒŒæ™¯ææ–™ä¸­"ä¹™"é¡¹ä¸‹çš„å†…å®¹é€šå¸¸æ¶‰åŠå¯¹ç”¨è¯äººç¾¤æˆ–æƒ…å†µçš„ä¸¥æ ¼é™åˆ¶ï¼Œä¾‹å¦‚"å¯¹æœ¬å“åŠæ‰€å«æˆåˆ†è¿‡æ•è€…ç¦ç”¨"ç­‰ï¼Œè¿™å±äºã€ç¦å¿Œã€‘é¡¹ä¸‹çš„å†…å®¹ã€‚',
  
  // é¢˜105: ç½‘ç»œé”€å”®èµ„è´¨å…¬ç¤º
  105: 'è¯å“ç½‘ç»œäº¤æ˜“ç¬¬ä¸‰æ–¹å¹³å°åº”å½“åœ¨å…¶ç½‘ç«™é¦–é¡µæˆ–è€…ä»äº‹ç»è¥æ´»åŠ¨çš„ä¸»é¡µé¢æ˜¾è‘—ä½ç½®ï¼ŒæŒç»­å…¬ç¤ºè¥ä¸šæ‰§ç…§ã€ç›¸å…³è¡Œæ”¿è®¸å¯ã€å¤‡æ¡ˆã€è”ç³»æ–¹å¼ç­‰ä¿¡æ¯æˆ–è€…ä¸Šè¿°ä¿¡æ¯çš„é“¾æ¥æ ‡è¯†ã€‚å› æ­¤Bé€‰é¡¹ç¬¦åˆè§„å®šã€‚Aé€‰é¡¹å¤„æ–¹è¯éœ€å‡­å¤„æ–¹è´­ä¹°ï¼Œä¸åº”ç›´æ¥å¼€æ”¾ä»·æ ¼æœç´¢å’ŒåŠ å…¥è´­ç‰©è½¦ã€‚Cé€‰é¡¹å¤„æ–¹è¯ä¸å¾—åœ¨ç½‘ä¸Šå±•ç¤ºåŒ…è£…ã€æ ‡ç­¾ã€‚Dé€‰é¡¹å¤„æ–¹è¯ä¸å¾—ä»¥ä¹°è¯å“èµ è¯å“ã€ä¹°å•†å“èµ è¯å“ç­‰æ–¹å¼å‘å…¬ä¼—èµ é€å¤„æ–¹è¯ã€‚',
  
  // é¢˜106: é€€è´§å¤„ç†è§„å®š
  106: 'Cé€‰é¡¹ä¸­ï¼Œä¹™å¯¹äºå› å‘é”™è´§è€Œé€€å›çš„è¯å“ï¼Œç›´æ¥æŒ‰ä¸åˆæ ¼è¯å“äºˆä»¥å¤„ç½®ï¼Œç¬¦åˆè¯å“è´¨é‡ç®¡ç†è¦æ±‚ï¼Œé˜²æ­¢äº†å·®é”™è¯å“å†æ¬¡æµå…¥å¸‚åœºã€‚Aé€‰é¡¹ï¼Œå·²å”®å‡ºè¯å“è¢«æ‹†å¼€åŒ…è£…åï¼Œå³ä½¿æœªæœç”¨ï¼Œä¹Ÿä¸å¾—æ”¶å›å†é”€å”®ã€‚Bé€‰é¡¹ï¼Œå› é…é€é”™è¯¯é€€å›çš„è¯å“ï¼Œæœªç»è´¨é‡ç¡®è®¤ä¸å¾—ç»§ç»­é”€å”®ã€‚Dé€‰é¡¹ï¼Œè¯å“å­˜åœ¨è´¨é‡é—®é¢˜ï¼ˆæ³„æ¼ï¼‰ï¼Œé›¶å”®ä¼ä¸šåº”å½“è´Ÿè´£é€€è´§ï¼Œå¹¶å±¥è¡Œè´¨é‡è´£ä»»ï¼Œä¸èƒ½ä»¥"å°å£è´¹"å’Œ"å¥½è¯„"æ©ç›–é—®é¢˜ã€‚',
  
  // é¢˜108: ç½‘ç»œé”€å”®ä¿ƒé”€æ´»åŠ¨
  108: 'Aé€‰é¡¹æ˜ç¡®å°†å¤„æ–¹è¯å’Œç”²ç±»éå¤„æ–¹è¯æ’é™¤åœ¨ä¿ƒé”€æ´»åŠ¨ï¼ˆå…é…é€è´¹ï¼‰ä¹‹å¤–ï¼Œç¬¦åˆè¯å“ç½‘ç»œé”€å”®ç®¡ç†è§„å®šã€‚Bé€‰é¡¹è¯å“ä¸å¾—æ†ç»‘é”€å”®ã€‚Cé€‰é¡¹å¤„æ–¹è¯ä¸å¾—å®è¡Œæœ‰å¥–é”€å”®ã€é™„èµ è¯å“æˆ–ç¤¼å“é”€å”®ï¼Œä¹Ÿä¸å¾—è¿›è¡Œå„ç§å½¢å¼çš„ä¿ƒé”€æ´»åŠ¨ã€‚Dé€‰é¡¹é”€å”®éå¤„æ–¹è¯æ— éœ€è¿œç¨‹æŒ‡å¯¼ï¼Œä¸”åº”ç”±æ‰§ä¸šè¯å¸ˆæä¾›è¯å­¦æœåŠ¡ã€‚',
  
  // é¢˜109: å¤æ–¹ç”˜è‰ç‰‡é”€å”®ç®¡ç†
  109: 'æ ¹æ®å«ç‰¹æ®Šè¯å“å¤æ–¹åˆ¶å‰‚æµé€šç®¡ç†è§„å®šï¼Œè¯å“æ‰¹å‘ä¼ä¸šï¼ˆä¹™ï¼‰å¯ä»¥ä»è¯å“ä¸Šå¸‚è®¸å¯æŒæœ‰äººæˆ–ç”Ÿäº§ä¼ä¸šï¼ˆç”²ï¼‰è´­è¿›æ­¤ç±»è¯å“ï¼Œå¹¶é”€å”®ç»™å…¶ä»–å…·å¤‡èµ„è´¨çš„è¯å“æ‰¹å‘ä¼ä¸šï¼ˆä¸™ï¼‰ã€é›¶å”®ä¼ä¸šå’ŒåŒ»ç–—æœºæ„ã€‚',
  
  // é¢˜110: è¯å“è°ƒæ‹¨ç®¡ç†
  110: 'Aé€‰é¡¹æè¿°çš„è¡Œä¸ºå±äº"æ‹†ä¸œå¢™è¡¥è¥¿å¢™"ï¼Œæ‰°ä¹±äº†è¯å“çš„è´­é”€è®°å½•å’Œè¿½æº¯ä½“ç³»ï¼Œä¸ç¬¦åˆè¯å“ç»è¥è´¨é‡ç®¡ç†è§„èŒƒï¼Œæ˜¯é”™è¯¯çš„è¡Œä¸ºã€‚',
  
  // é¢˜120: åŒ–å¦†å“æ–°åŸæ–™æ³¨å†Œ
  120: 'æ ¹æ®ã€ŠåŒ–å¦†å“ç›‘ç£ç®¡ç†æ¡ä¾‹ã€‹ï¼Œå…·æœ‰é˜²è…ã€é˜²æ™’ã€ç€è‰²ã€æŸ“å‘ã€ç¥›æ–‘ç¾ç™½åŠŸèƒ½çš„åŒ–å¦†å“æ–°åŸæ–™ï¼Œç»å›½åŠ¡é™¢è¯å“ç›‘ç£ç®¡ç†éƒ¨é—¨æ³¨å†Œåæ–¹å¯ä½¿ç”¨ï¼›å…¶ä»–åŒ–å¦†å“æ–°åŸæ–™åº”å½“åœ¨ä½¿ç”¨å‰å‘å›½åŠ¡é™¢è¯å“ç›‘ç£ç®¡ç†éƒ¨é—¨å¤‡æ¡ˆã€‚å› æ­¤ï¼Œé˜²æ™’ã€ç¥›æ–‘ç¾ç™½ã€æŸ“å‘åŠŸèƒ½çš„æ–°åŸæ–™éœ€è¦æ³¨å†Œï¼Œè€Œæ™®é€šæŠ¤è‚¤åŠŸèƒ½çš„æ–°åŸæ–™åªéœ€å¤‡æ¡ˆã€‚'
};

async function main() {
  console.log('ğŸ”§ æ›´æ–°2023å¹´æ³•è§„ç¼ºå¤±çš„è§£æ\n');

  if (Object.keys(MISSING_ANALYSIS).length === 0) {
    console.log('âš ï¸  MISSING_ANALYSISä¸ºç©ºï¼Œè¯·å…ˆæ·»åŠ è§£æå†…å®¹');
    console.log('\nğŸ’¡ ä½¿ç”¨æ­¥éª¤:');
    console.log('1. è¿è¡Œ npx tsx list-2023-fagui-missing-analysis.ts æŸ¥çœ‹ç¼ºå¤±é¢˜ç›®');
    console.log('2. åœ¨æœ¬æ–‡ä»¶çš„ MISSING_ANALYSIS ä¸­æ·»åŠ è§£æå†…å®¹');
    console.log('3. å†æ¬¡è¿è¡Œæœ¬è„šæœ¬è¿›è¡Œæ›´æ–°');
    return;
  }

  let successCount = 0;
  let errorCount = 0;

  for (const [questionNumStr, analysis] of Object.entries(MISSING_ANALYSIS)) {
    const questionNum = parseInt(questionNumStr);
    
    try {
      // è·å–æŒ‡å®šé¢˜å·çš„é¢˜ç›®
      const questions = await prisma.questions.findMany({
        where: {
          source_year: 2023,
          subject: 'è¯äº‹ç®¡ç†ä¸æ³•è§„'
        },
        orderBy: { created_at: 'asc' },
        skip: questionNum - 1,
        take: 1
      });

      if (questions.length === 0) {
        console.log(`âŒ é¢˜${questionNum}: æœªæ‰¾åˆ°`);
        errorCount++;
        continue;
      }

      const question = questions[0];

      // æ›´æ–°è§£æ
      await prisma.questions.update({
        where: { id: question.id },
        data: {
          ai_explanation: analysis
        }
      });

      console.log(`âœ… é¢˜${questionNum}: å·²æ›´æ–°è§£æ (${analysis.substring(0, 30)}...)`);
      successCount++;

    } catch (error) {
      console.error(`âŒ é¢˜${questionNum}: æ›´æ–°å¤±è´¥`, error);
      errorCount++;
    }
  }

  console.log('\n' + '='.repeat(60));
  console.log('ğŸ“Š æ›´æ–°ç»Ÿè®¡:');
  console.log(`âœ… æˆåŠŸ: ${successCount} é“é¢˜`);
  console.log(`âŒ å¤±è´¥: ${errorCount} é“é¢˜`);
  console.log('='.repeat(60));

  // éªŒè¯æ›´æ–°ç»“æœ
  if (successCount > 0) {
    console.log('\nğŸ” éªŒè¯æ›´æ–°ç»“æœ:\n');
    
    const updatedQuestions = await prisma.questions.findMany({
      where: {
        source_year: 2023,
        subject: 'è¯äº‹ç®¡ç†ä¸æ³•è§„'
      },
      orderBy: { created_at: 'asc' },
      skip: 100,
      take: 10,
      select: {
        ai_explanation: true
      }
    });

    updatedQuestions.forEach((q, index) => {
      const questionNum = 101 + index;
      const hasExplanation = q.ai_explanation && q.ai_explanation.trim() !== '';
      const status = hasExplanation ? 'âœ…' : 'âŒ';
      console.log(`é¢˜${questionNum} ${status}: ${hasExplanation ? 'æœ‰è§£æ' : 'æ— è§£æ'}`);
    });
  }
}

main()
  .catch((error) => {
    console.error('âŒ æ›´æ–°è¿‡ç¨‹å‡ºé”™:', error);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
