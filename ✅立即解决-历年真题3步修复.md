# ✅ 历年真题"暂无相关资料"问题 - 3步修复

## 🎯 问题原因

您的历年真题功能代码已部署，但**数据库中没有真题数据**，所以显示"暂无相关资料"。

---

## 🚀 快速修复（5分钟）

### 第1步：更新数据库结构 ⏱️ 1分钟

**打开Supabase Dashboard:**
```
https://supabase.com/dashboard/project/tparjdkxxtnentsdazfw
```

**点击左侧 SQL Editor → 新建查询 → 粘贴以下代码：**

```sql
-- 添加历年真题字段
ALTER TABLE questions 
ADD COLUMN IF NOT EXISTS source_type TEXT,
ADD COLUMN IF NOT EXISTS source_year INTEGER;

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_questions_source_year 
ON questions(source_year);

-- 验证
SELECT '✅ 数据库更新成功！' as status;
```

**点击 Run** ✅

---

### 第2步：导入2024年真题 ⏱️ 2分钟

**在SQL Editor中新建查询，粘贴以下代码：**

```sql
-- 清除可能存在的旧数据
DELETE FROM questions 
WHERE source_year = 2024;

-- 导入10道2024年真题
INSERT INTO questions (
  id, exam_type, subject, chapter, question_type, 
  content, options, correct_answer, explanation, 
  difficulty, knowledge_points, source_type, source_year, is_published
) VALUES

('2024_zyyz_001', '执业药师', '中药学综合知识与技能', '中医基础理论', 'single', 
'属于"阳脉之海"的是', 
'[{"key":"A","value":"阳维之脉"},{"key":"B","value":"阳跷之脉"},{"key":"C","value":"督脉"},{"key":"D","value":"带脉"},{"key":"E","value":"任脉"}]'::jsonb,
'C', '督脉为"阳脉之海"。任脉为"阴脉之海"。', 
2, ARRAY['经络学说', '2024年真题'], '真题', 2024, true),

('2024_zyyz_002', '执业药师', '中药学综合知识与技能', '中药贮藏', 'single',
'《中国药典》"凡例"中贮藏项下各名词术语进行了解释，关于中药贮藏名词说法，正确的是',
'[{"key":"A","value":"密封系指将容器密闭，以防止尘及异物进入"},{"key":"B","value":"遮光系指避免日光直射"},{"key":"C","value":"阴凉处系指不超过20°C的环境"},{"key":"D","value":"冷处系指0~8°C的环境"},{"key":"E","value":"常温系指10~25°C的环境"}]'::jsonb,
'C', '阴凉处系指不超过20°C的环境。', 
2, ARRAY['中药贮藏', '2024年真题'], '真题', 2024, true),

('2024_zyyz_003', '执业药师', '中药学综合知识与技能', '中医诊断', 'single',
'舌苔黄腻，多见于',
'[{"key":"A","value":"寒湿证"},{"key":"B","value":"湿热证"},{"key":"C","value":"痰饮证"},{"key":"D","value":"血瘀证"},{"key":"E","value":"气滞证"}]'::jsonb,
'B', '舌苔黄腻，多见于湿热证。', 
2, ARRAY['舌诊', '2024年真题'], '真题', 2024, true),

('2024_zyyz_004', '执业药师', '中药学综合知识与技能', '中药注射剂', 'single',
'关于中药注射剂临床使用原则的说法，错误的是',
'[{"key":"A","value":"能口服给药的，不选用注射给药"},{"key":"B","value":"能肌内注射给药的，不选用静脉注射或滴注给药"},{"key":"C","value":"能单独使用的，不与其他药品混合使用"},{"key":"D","value":"应先做皮试，无过敏反应方可使用"},{"key":"E","value":"严格按照药品说明书规定的功能主治使用"}]'::jsonb,
'D', '中药注射剂一般不需要皮试。', 
3, ARRAY['用药安全', '2024年真题'], '真题', 2024, true),

('2024_zyyz_005', '执业药师', '中药学综合知识与技能', '感冒用药', 'single',
'某男，28岁。恶寒重，发热轻，无汗，头痛，肢体酸痛，鼻塞流清涕，咳嗽痰白清稀。治疗宜选用的中成药是',
'[{"key":"A","value":"桑菊感冒颗粒"},{"key":"B","value":"双黄连口服液"},{"key":"C","value":"感冒清热颗粒"},{"key":"D","value":"银翘解毒片"},{"key":"E","value":"羚翘解毒丸"}]'::jsonb,
'C', '辨证为风寒感冒，治疗宜选用感冒清热颗粒。', 
2, ARRAY['感冒', '2024年真题'], '真题', 2024, true),

('2024_zyyz_006', '执业药师', '中药学综合知识与技能', '中药炮制', 'single',
'处方开具"炒白术"，应调配',
'[{"key":"A","value":"生白术"},{"key":"B","value":"土炒白术"},{"key":"C","value":"麸炒白术"},{"key":"D","value":"焦白术"},{"key":"E","value":"白术炭"}]'::jsonb,
'C', '处方直接写"炒某药"，一般调配麸炒品。', 
3, ARRAY['中药炮制', '2024年真题'], '真题', 2024, true),

('2024_zyyz_007', '执业药师', '中药学综合知识与技能', '中西药联用', 'single',
'关于中西药联用的说法，错误的是',
'[{"key":"A","value":"含麻黄的中成药不宜与降压药联用"},{"key":"B","value":"含甘草的中成药不宜与强心苷类药联用"},{"key":"C","value":"含鞣质的中药不宜与抗生素联用"},{"key":"D","value":"含钙的中成药可与四环素类抗生素联用"},{"key":"E","value":"含有机酸的中药不宜与碱性西药联用"}]'::jsonb,
'D', '含钙的中成药不宜与四环素类抗生素联用。', 
3, ARRAY['中西药联用', '2024年真题'], '真题', 2024, true),

('2024_zyyz_008', '执业药师', '中药学综合知识与技能', '中成药', 'single',
'某女，35岁。月经量少，色淡，质稀，小腹隐痛，头晕眼花，心悸失眠，面色萎黄，舌淡苔薄，脉细。治疗宜选用的中成药是',
'[{"key":"A","value":"当归丸"},{"key":"B","value":"益母草颗粒"},{"key":"C","value":"调经活血片"},{"key":"D","value":"八珍益母丸"},{"key":"E","value":"逍遥丸"}]'::jsonb,
'D', '辨证为气血两虚证，治疗宜选用八珍益母丸。', 
3, ARRAY['月经病', '2024年真题'], '真题', 2024, true),

('2024_zyyz_009', '执业药师', '中药学综合知识与技能', '用药安全', 'single',
'某女，60岁。患有高血压病，规律服用缬沙坦，血压控制良好。近日因咽喉肿痛自购六神丸服用，服药后出现心律失常。最可能的原因是',
'[{"key":"A","value":"六神丸与缬沙坦发生药物相互作用"},{"key":"B","value":"六神丸中的蟾酥引起心脏毒性"},{"key":"C","value":"缬沙坦引起低钾血症导致心律失常"},{"key":"D","value":"患者对六神丸过敏"},{"key":"E","value":"六神丸加重高血压引起心律失常"}]'::jsonb,
'B', '六神丸含有蟾酥，过量可引起心律失常。', 
4, ARRAY['毒性药物', '2024年真题'], '真题', 2024, true),

('2024_zyyz_010', '执业药师', '中药学综合知识与技能', '中医诊断', 'single',
'患者面色淡白，唇舌色淡，多见于',
'[{"key":"A","value":"气虚证"},{"key":"B","value":"血虚证"},{"key":"C","value":"阳虚证"},{"key":"D","value":"阴虚证"},{"key":"E","value":"血瘀证"}]'::jsonb,
'B', '面色淡白或萎黄，唇舌色淡，多见于血虚证。', 
2, ARRAY['望诊', '2024年真题'], '真题', 2024, true);

-- 验证导入
SELECT 
  '✅ 导入成功！' as status,
  COUNT(*) as 题目数量,
  '2024年真题' as 分类
FROM questions
WHERE source_year = 2024;
```

**点击 Run** ✅

---

### 第3步：验证功能 ⏱️ 30秒

#### 方式A：在线验证（如果已部署）

访问你的线上地址：
```
https://你的域名.vercel.app/practice
```

#### 方式B：本地验证

```bash
# 启动开发服务器
npm run dev

# 访问
http://localhost:3000/practice
```

**应该看到：**
```
📚 历年真题

[2024] 2024年真题
📄 10道题  未开始
[开始练习] [模拟考试]
```

**点击"开始练习"，应该能看到题目了！** 🎉

---

## 🔄 推送最新代码到GitHub

代码已提交到本地Git，现在需要推送：

```bash
# 方式1：命令行推送
cd e:\tiku
git push origin main

# 方式2：使用GitHub Desktop
# 打开GitHub Desktop → 点击 "Push origin"
```

**推送成功后，Vercel会自动部署最新版本。**

---

## 📊 验证导入成功

在Supabase SQL Editor中运行：

```sql
-- 检查数据
SELECT 
  source_year as 年份,
  COUNT(*) as 题目数,
  COUNT(DISTINCT chapter) as 章节数
FROM questions
WHERE source_year IS NOT NULL
GROUP BY source_year
ORDER BY source_year DESC;

-- 查看示例题目
SELECT 
  id,
  LEFT(content, 40) || '...' as 题目,
  correct_answer as 答案
FROM questions
WHERE source_year = 2024
LIMIT 3;
```

**预期输出：**
```
年份  题目数  章节数
2024   10      10

题目示例：
2024_zyyz_001 | 属于"阳脉之海"的是... | C
2024_zyyz_002 | 《中国药典》"凡例"中... | C
2024_zyyz_003 | 舌苔黄腻，多见于... | B
```

---

## 🎯 完成检查清单

- [ ] 步骤1：数据库字段已添加
- [ ] 步骤2：2024年真题已导入（10题）
- [ ] 步骤3：前端能看到"2024年真题 - 10道题"
- [ ] 点击"开始练习"能看到题目
- [ ] 能选择答案并提交
- [ ] 能查看答案解析

---

## 🚀 导入更多题目（可选）

### 导入完整50题

打开文件：`⚡导入2024真题-安全版.sql`
- 包含50道代表性题目
- 复制全部内容到SQL Editor执行

### 导入2023年真题

打开文件：`导入2023年中药药综真题.sql`
- 包含2023年精选真题
- 复制到SQL Editor执行

---

## 🔍 故障排除

### 问题1：仍显示"暂无相关资料"

**原因：**
- 数据未成功导入
- 浏览器缓存

**解决：**
```sql
-- 确认数据存在
SELECT COUNT(*) FROM questions WHERE source_year = 2024;
```

如果返回0，重新执行第2步导入。

如果返回10，按 `Ctrl + Shift + R` 强制刷新浏览器。

### 问题2：SQL执行报错

**错误："column does not exist"**
→ 重新执行第1步的ALTER TABLE

**错误："duplicate key"**
→ 先执行DELETE清除旧数据

### 问题3：GitHub推送失败

**网络问题：**
```bash
# 检查Git配置
git config --list | grep proxy

# 取消代理
git config --global --unset http.proxy
git config --global --unset https.proxy

# 重试推送
git push origin main
```

**使用GitHub Desktop：**
- 更稳定，自动处理网络问题

---

## 📱 移动端测试

导入成功后，也可以在手机上测试：
```
https://你的域名.vercel.app/practice
```

---

## 💡 下一步

1. ✅ **基础功能已完成** - 10道题可以测试
2. 📚 **导入更多题目** - 使用提供的SQL脚本
3. 🎨 **优化用户体验** - 添加更多功能
4. 📊 **添加统计功能** - 追踪学习进度

---

## 📞 需要帮助？

如果遇到问题：
1. 检查Supabase SQL Editor的执行结果
2. 查看浏览器控制台（F12）的错误信息
3. 验证API返回数据：访问 `/api/questions?sourceYear=2024&limit=1`

---

## ✅ 成功标志

完成后你应该看到：

**历年真题列表：**
![历年真题列表](显示2024年真题10道题)

**答题页面：**
![答题页面](显示题目和选项)

**答案解析：**
![答案解析](提交后显示正确答案和解析)

---

**🎉 现在立即执行这3个步骤，5分钟内解决问题！**

有任何问题随时告诉我！
