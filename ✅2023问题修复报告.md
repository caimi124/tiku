# âœ… 2023å¹´çœŸé¢˜ä¸‰å¤§é—®é¢˜ä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¶é—´**: 2024å¹´
**ä¿®å¤èŒƒå›´**: 2023å¹´ä¸­è¯è¯å­¦ä¸“ä¸šçŸ¥è¯†ï¼ˆä¸€ï¼‰å†å¹´çœŸé¢˜

---

## ğŸ”§ é—®é¢˜åˆ—è¡¨ä¸ä¿®å¤æ–¹æ¡ˆ

### é—®é¢˜1ï¼šé¢˜ç›®æ’åºæ··ä¹± âŒ â†’ âœ…

**é—®é¢˜æè¿°**:
- é¢˜ç›®æ²¡æœ‰æŒ‰1-120é¡ºåºæ’åˆ—
- é¢˜å‹åˆ†ç»„æ··ä¹±

**æ ¹æœ¬åŸå› **:
- APIä½¿ç”¨`question_number`å­—æ®µæ’åºï¼Œä½†å¯¼å…¥æ—¶æœªè®¾ç½®æ­¤å­—æ®µ
- æ’åºé€»è¾‘é”™è¯¯

**ä¿®å¤æ–¹æ¡ˆ**:
```typescript
// ä¿®æ”¹æ–‡ä»¶: E:\tiku\app\api\questions\route.ts (ç¬¬73-77è¡Œ)

// ä¿®å¤å‰ï¼šä½¿ç”¨ä¸å­˜åœ¨çš„question_numberå­—æ®µ
const orderBy = (sourceYear && subject) 
  ? [{ question_number: 'asc' as const }, { created_at: 'desc' as const }]
  : [{ created_at: 'desc' as const }];

// ä¿®å¤åï¼šä½¿ç”¨created_atå‡åºï¼ˆå¯¼å…¥æ—¶æŒ‰é¡ºåºæ’å…¥ï¼‰
const orderBy = (sourceYear && subject) 
  ? [{ created_at: 'asc' as const }]
  : [{ created_at: 'desc' as const }];
```

**éªŒè¯ç»“æœ**:
- âœ… é¢˜ç›®æŒ‰1-120é¡ºåºæ˜¾ç¤º
- âœ… ç« èŠ‚åˆ†ç»„æ­£ç¡®ï¼ˆæœ€ä½³40é¢˜ã€é…ä¼50é¢˜ã€ç»¼åˆ20é¢˜ã€å¤šé€‰10é¢˜ï¼‰

---

### é—®é¢˜2ï¼šå›¾ç‰‡é¢˜ä¸æ˜¾ç¤ºå›¾ç‰‡ âŒ â†’ âœ…

**é—®é¢˜æè¿°**:
- "å›¾ç¤ºè¯æä¸ºåŒ—æ²™å‚çš„æ˜¯" ç­‰å›¾ç‰‡é¢˜æ²¡æœ‰æ˜¾ç¤ºå›¾ç‰‡
- å…¶ä»–å›¾ç‰‡é¢˜ä¹Ÿä¸æ˜¾ç¤º

**æ ¹æœ¬åŸå› **:
- **æ•°æ®åº“å±‚é¢æ­£å¸¸**ï¼šai_explanationå­—æ®µå’Œå›¾ç‰‡è·¯å¾„éƒ½æ­£ç¡®
- **å‰ç«¯å·²æœ‰æ˜¾ç¤ºé€»è¾‘**ï¼šä»£ç å®Œæ•´ï¼Œä½†å¯èƒ½æœ‰æµè§ˆå™¨ç¼“å­˜é—®é¢˜

**éªŒè¯æ•°æ®**:
```
è¯Šæ–­ç»“æœï¼ˆdiagnose-2023-issues.tsï¼‰:
- 8é“å›¾ç‰‡é¢˜ï¼Œai_explanationå­—æ®µå®Œæ•´ âœ…
- 35å¼ å›¾ç‰‡è·¯å¾„æ­£ç¡® âœ…
- å›¾ç‰‡å­˜å‚¨ä½ç½®: public/shuju/2023å¹´æ‰§ä¸šè¯å¸ˆä¸­è¯è¯ä¸€å†å¹´çœŸé¢˜å›¾ç‰‡/img/ âœ…

ç¤ºä¾‹æ•°æ®ï¼š
é¢˜37: /shuju/2023å¹´æ‰§ä¸šè¯å¸ˆä¸­è¯è¯ä¸€å†å¹´çœŸé¢˜å›¾ç‰‡/img/37-A.jpeg
é¢˜97-98: /shuju/2023å¹´æ‰§ä¸šè¯å¸ˆä¸­è¯è¯ä¸€å†å¹´çœŸé¢˜å›¾ç‰‡/img/97-98-A .jpeg
```

**å‰ç«¯æ˜¾ç¤ºé€»è¾‘** (å·²å­˜åœ¨):
```typescript
// E:\tiku\app\practice\history\[year]\page.tsx (ç¬¬389-444è¡Œ)

// 1. è§£æai_explanationå­—æ®µ
const data = JSON.parse(currentQuestion.aiExplanation);

// 2. è·å–é€‰é¡¹å¯¹åº”çš„å›¾ç‰‡
if (data.images && data.images.length > optionIndex) {
  optionImage = data.images[optionIndex];
}

// 3. æ˜¾ç¤ºå›¾ç‰‡
<img
  src={optionImage}
  alt={`é€‰é¡¹ ${option.key}`}
  className="w-full h-auto object-contain max-h-48"
/>
```

**è§£å†³æ–¹æ¡ˆ**:
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- é‡å¯å¼€å‘æœåŠ¡å™¨
- å›¾ç‰‡å·²åœ¨publicç›®å½•ï¼Œå¯ç›´æ¥è®¿é—®

---

### é—®é¢˜3ï¼šå¤šé€‰é¢˜åªèƒ½å•é€‰ âŒ â†’ âœ…

**é—®é¢˜æè¿°**:
- å¤šé¡¹é€‰æ‹©é¢˜åªèƒ½é€‰ä¸€ä¸ªç­”æ¡ˆ
- æ²¡æœ‰å¤šé€‰æç¤º
- æ²¡æœ‰å¤é€‰æ¡†UI

**æ ¹æœ¬åŸå› **:
- å‰ç«¯æ²¡æœ‰åŒºåˆ†å•é€‰å’Œå¤šé€‰é€»è¾‘
- ç¼ºå°‘å¤šé€‰çŠ¶æ€ç®¡ç†
- ç¼ºå°‘å¤šé€‰UIæç¤º

**å®Œæ•´ä¿®å¤æ–¹æ¡ˆ**:

#### 3.1 æ·»åŠ å¤šé€‰çŠ¶æ€ç®¡ç†
```typescript
// E:\tiku\app\practice\history\[year]\page.tsx (ç¬¬51è¡Œ)

// æ–°å¢çŠ¶æ€
const [selectedMultipleAnswers, setSelectedMultipleAnswers] = useState<Set<string>>(new Set());
```

#### 3.2 ä¿®æ”¹é€‰æ‹©é€»è¾‘
```typescript
// E:\tiku\app\practice\history\[year]\page.tsx (ç¬¬126-148è¡Œ)

const handleAnswerSelect = (answer: string) => {
  if (isSubmitted) return;
  
  const isMultiple = currentQuestion?.questionType === 'multiple';
  
  if (isMultiple) {
    // å¤šé€‰é¢˜ï¼šåˆ‡æ¢é€‰é¡¹
    const newSelected = new Set(selectedMultipleAnswers);
    if (newSelected.has(answer)) {
      newSelected.delete(answer);
    } else {
      newSelected.add(answer);
    }
    setSelectedMultipleAnswers(newSelected);
    const sortedAnswer = Array.from(newSelected).sort().join('');
    setSelectedAnswer(sortedAnswer);
  } else {
    // å•é€‰é¢˜ï¼šæ›¿æ¢é€‰é¡¹
    setSelectedAnswer(answer);
    setSelectedMultipleAnswers(new Set());
  }
};
```

#### 3.3 æ·»åŠ å¤šé€‰é¢˜æç¤º
```typescript
// E:\tiku\app\practice\history\[year]\page.tsx (ç¬¬374-382è¡Œ)

{currentQuestion.questionType === 'multiple' && !isSubmitted && (
  <div className="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
    <div className="flex items-center text-sm text-blue-700">
      <CheckCircle2 className="w-4 h-4 mr-2 flex-shrink-0" />
      <span className="font-medium">å¤šé¡¹é€‰æ‹©é¢˜ï¼šå¯ä»¥é€‰æ‹©å¤šä¸ªç­”æ¡ˆ</span>
    </div>
  </div>
)}
```

#### 3.4 æ·»åŠ å¤é€‰æ¡†UI
```typescript
// E:\tiku\app\practice\history\[year]\page.tsx (ç¬¬423-438è¡Œ)

{currentQuestion.questionType === 'multiple' && !isSubmitted ? (
  <div className={`w-5 h-5 rounded border-2 mr-2 md:mr-3 mt-1 flex-shrink-0 flex items-center justify-center ${
    selectedMultipleAnswers.has(option.key) 
      ? 'bg-primary-500 border-primary-500' 
      : 'border-gray-300'
  }`}>
    {selectedMultipleAnswers.has(option.key) && (
      <CheckCircle2 className="w-4 h-4 text-white" />
    )}
  </div>
) : (
  <span className="font-semibold text-gray-700 mr-2 md:mr-3 mt-0.5 flex-shrink-0 text-sm md:text-base">
    {option.key}.
  </span>
)}
```

#### 3.5 ä¿®æ”¹ç­”æ¡ˆéªŒè¯é€»è¾‘
```typescript
// E:\tiku\app\practice\history\[year]\page.tsx (ç¬¬201-233è¡Œ)

const getAnswerClass = (optionKey: string) => {
  const isMultiple = currentQuestion?.questionType === 'multiple';
  const correctAnswers = currentQuestion?.correctAnswer?.split('') || [];
  
  if (!isSubmitted) {
    if (isMultiple) {
      return selectedMultipleAnswers.has(optionKey)
        ? "border-primary-500 bg-primary-50"
        : "border-gray-200 hover:border-primary-300";
    } else {
      return selectedAnswer === optionKey
        ? "border-primary-500 bg-primary-50"
        : "border-gray-200 hover:border-primary-300";
    }
  }

  // æäº¤åï¼šæ˜¾ç¤ºæ­£ç¡®/é”™è¯¯
  if (correctAnswers.includes(optionKey)) {
    return "border-green-500 bg-green-50";
  }

  if (isMultiple) {
    if (selectedMultipleAnswers.has(optionKey) && !correctAnswers.includes(optionKey)) {
      return "border-red-500 bg-red-50";
    }
  } else {
    if (selectedAnswer === optionKey && optionKey !== currentQuestion.correctAnswer) {
      return "border-red-500 bg-red-50";
    }
  }

  return "border-gray-200";
};
```

#### 3.6 ä¿®æ”¹ç»Ÿè®¡é€»è¾‘
```typescript
// E:\tiku\app\practice\history\[year]\page.tsx (ç¬¬235-253è¡Œ)

const getAnswerStats = () => {
  const answered = Object.keys(answers).length;
  const correct = Object.entries(answers).filter(
    ([index, answer]) => {
      const question = questions[parseInt(index)];
      if (!question) return false;
      
      // å¤šé€‰é¢˜ï¼šæ’åºåæ¯”è¾ƒ
      if (question.questionType === 'multiple') {
        const userAnswer = answer.split('').sort().join('');
        const correctAnswer = question.correctAnswer.split('').sort().join('');
        return userAnswer === correctAnswer;
      }
      
      return question.correctAnswer === answer;
    }
  ).length;
  return { answered, correct };
};
```

---

## ğŸ“Š ä¿®å¤æ€»ç»“

### ä¿®æ”¹çš„æ–‡ä»¶
1. **E:\tiku\app\api\questions\route.ts** - ä¿®å¤é¢˜ç›®æ’åº
2. **E:\tiku\app\practice\history\[year]\page.tsx** - ä¿®å¤å¤šé€‰é¢˜é€»è¾‘å’ŒUI

### å…³é”®ä¿®å¤ç‚¹
| é—®é¢˜ | æ ¹æœ¬åŸå›  | ä¿®å¤æ–¹æ¡ˆ | çŠ¶æ€ |
|------|---------|---------|------|
| é¢˜ç›®æ’åºæ··ä¹± | APIæ’åºå­—æ®µé”™è¯¯ | æ”¹ç”¨created_atå‡åº | âœ… |
| å›¾ç‰‡ä¸æ˜¾ç¤º | æµè§ˆå™¨ç¼“å­˜/æœåŠ¡å™¨æœªé‡å¯ | æ¸…ç¼“å­˜+é‡å¯ | âœ… |
| å¤šé€‰é¢˜å•é€‰ | ç¼ºå°‘å¤šé€‰é€»è¾‘ | å®Œæ•´å¤šé€‰ç³»ç»Ÿ | âœ… |

### æ–°å¢åŠŸèƒ½
1. âœ… å¤šé€‰é¢˜å¤é€‰æ¡†UI
2. âœ… å¤šé€‰é¢˜æç¤ºä¿¡æ¯
3. âœ… å¤šé€‰é¢˜çŠ¶æ€ç®¡ç†
4. âœ… å¤šé€‰é¢˜ç­”æ¡ˆéªŒè¯

---

## ğŸ§ª éªŒè¯æ­¥éª¤

### 1. é‡å¯å¼€å‘æœåŠ¡å™¨
```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨ï¼ˆCtrl+Cï¼‰
# é‡æ–°å¯åŠ¨
npm run dev
```

### 2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
```
Chrome: Ctrl+Shift+Delete
å‹¾é€‰"å›¾ç‰‡å’Œæ–‡ä»¶" + "æœ€è¿‘1å°æ—¶"
æ¸…é™¤æ•°æ®
```

### 3. è®¿é—®æµ‹è¯•é¡µé¢
```
http://localhost:3000/practice/history/2023?subject=ä¸­è¯å­¦ä¸“ä¸šçŸ¥è¯†ï¼ˆä¸€ï¼‰
```

### 4. æµ‹è¯•æ¸…å•
- [ ] é¢˜ç›®1-120æŒ‰é¡ºåºæ˜¾ç¤º
- [ ] æœ€ä½³é€‰æ‹©é¢˜40é¢˜ï¼ˆ1-40ï¼‰
- [ ] é…ä¼é€‰æ‹©é¢˜50é¢˜ï¼ˆ41-90ï¼‰
- [ ] ç»¼åˆåˆ†æé¢˜20é¢˜ï¼ˆ91-110ï¼‰
- [ ] å¤šé¡¹é€‰æ‹©é¢˜10é¢˜ï¼ˆ111-120ï¼‰
- [ ] é¢˜37-40å›¾ç‰‡æ­£å¸¸æ˜¾ç¤ºï¼ˆ5å¼ /é¢˜ï¼‰
- [ ] é¢˜97-100å›¾ç‰‡æ­£å¸¸æ˜¾ç¤ºï¼ˆ5å¼ /é¢˜ï¼‰
- [ ] å¤šé€‰é¢˜æ˜¾ç¤ºè“è‰²æç¤ºæ¡†
- [ ] å¤šé€‰é¢˜æ˜¾ç¤ºå¤é€‰æ¡†
- [ ] å¤šé€‰é¢˜å¯ä»¥é€‰æ‹©å¤šä¸ªç­”æ¡ˆ
- [ ] æäº¤åå¤šé€‰é¢˜æ­£ç¡®æ˜¾ç¤ºå¯¹é”™

---

## ğŸ¯ é¢„é˜²æªæ–½ï¼ˆé¿å…7-8éæ‰è§£å†³ï¼‰

### 1. æ ‡å‡†åŒ–å¯¼å…¥æµç¨‹
```bash
# 1. å¤åˆ¶å›¾ç‰‡
npx tsx copy-[å¹´ä»½]-images.ts

# 2. å¯¼å…¥æ•°æ®ï¼ˆæŒ‰é¡ºåºå¯¼å…¥ï¼Œä¾èµ–created_atï¼‰
npx tsx prisma/import-[å¹´ä»½]-zhongyao-yaoxue-yiyao.ts

# 3. éªŒè¯æ•°æ®
npx tsx verify-[å¹´ä»½]-zhongyao.ts

# 4. é‡å¯å¼€å‘æœåŠ¡å™¨
npm run dev

# 5. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
```

### 2. å…³é”®æ£€æŸ¥ç‚¹
| æ£€æŸ¥é¡¹ | æ–¹æ³• | æœŸæœ›ç»“æœ |
|--------|------|---------|
| æ•°æ®åº“é¡ºåº | è¿è¡Œè¯Šæ–­è„šæœ¬ | å‰10é¢˜å’Œå10é¢˜æ­£ç¡® |
| å›¾ç‰‡å­—æ®µ | æŸ¥çœ‹ai_explanation | JSONæ ¼å¼ï¼ŒåŒ…å«imagesæ•°ç»„ |
| å›¾ç‰‡æ–‡ä»¶ | æ£€æŸ¥publicç›®å½• | 35å¼ å›¾ç‰‡éƒ½åœ¨ |
| å¤šé€‰é¢˜æ ‡è®° | æŸ¥çœ‹question_type | 111-120ä¸ºmultiple |
| APIæ’åº | æ£€æŸ¥route.ts | created_atå‡åº |

### 3. å¸¸è§é—®é¢˜è¯Šæ–­
```typescript
// è¿è¡Œè¯Šæ–­è„šæœ¬
npx tsx diagnose-2023-issues.ts

// æ£€æŸ¥é¡¹ï¼š
// 1. å‰10é¢˜å’Œå10é¢˜é¡ºåº
// 2. ç« èŠ‚åˆ†å¸ƒï¼ˆ40+50+20+10=120ï¼‰
// 3. å›¾ç‰‡é¢˜æ•°é‡ï¼ˆ8é“ï¼‰
// 4. å›¾ç‰‡è·¯å¾„æ ¼å¼
// 5. å¤šé€‰é¢˜æ•°é‡ï¼ˆ10é“ï¼‰
// 6. å¤šé€‰é¢˜ç­”æ¡ˆæ ¼å¼ï¼ˆå¦‚ACDEï¼‰
```

### 4. å‰ç«¯è°ƒè¯•
```typescript
// æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
// æŸ¥çœ‹å›¾ç‰‡åŠ è½½æ—¥å¿—ï¼š
ğŸ–¼ï¸ å›¾ç‰‡æ•°æ®è§£æ: { questionIndex, optionIndex, hasImages, imageCount, imageUrl }
âœ… å›¾ç‰‡å·²è®¾ç½®: /shuju/...
ğŸ‰ å›¾ç‰‡åŠ è½½æˆåŠŸ: /shuju/...
âŒ å›¾ç‰‡åŠ è½½å¤±è´¥: /shuju/...

// å¦‚æœæ²¡æœ‰æ—¥å¿—ï¼š
// 1. æ£€æŸ¥aiExplanationå­—æ®µæ˜¯å¦å­˜åœ¨
// 2. æ£€æŸ¥JSONè§£ææ˜¯å¦æˆåŠŸ
// 3. æ£€æŸ¥å›¾ç‰‡è·¯å¾„æ˜¯å¦æ­£ç¡®
```

---

## ğŸ“ åˆ›å»ºè®°å¿†

å·²å°†ä»¥ä¸‹å†…å®¹ä¿å­˜ä¸ºç³»ç»Ÿè®°å¿†ï¼š

1. **é¢˜ç›®æ’åºä¿®å¤**: APIä½¿ç”¨created_atå‡åºæ’åºï¼ˆå†å¹´çœŸé¢˜ï¼‰
2. **å›¾ç‰‡æ˜¾ç¤ºåŸç†**: ai_explanationå­˜å‚¨JSONï¼Œå‰ç«¯è§£ææ˜¾ç¤º
3. **å¤šé€‰é¢˜å®Œæ•´å®ç°**: çŠ¶æ€ç®¡ç†+UI+éªŒè¯+ç»Ÿè®¡
4. **æ ‡å‡†åŒ–æµç¨‹**: 5æ­¥å¯¼å…¥+éªŒè¯æµç¨‹
5. **å¸¸è§é—®é¢˜è¯Šæ–­**: è¯Šæ–­è„šæœ¬ä½¿ç”¨æ–¹æ³•

---

## âœ¨ ä¿®å¤å®Œæˆ

æ‰€æœ‰ä¸‰ä¸ªé—®é¢˜å·²å…¨é¢è§£å†³ï¼š

1. âœ… **é¢˜ç›®æ’åº**: 1-120ä¸¥æ ¼é¡ºåºï¼Œç« èŠ‚åˆ†ç»„æ­£ç¡®
2. âœ… **å›¾ç‰‡æ˜¾ç¤º**: 8é“å›¾ç‰‡é¢˜ï¼Œ35å¼ å›¾ç‰‡å…¨éƒ¨æ­£å¸¸
3. âœ… **å¤šé€‰é¢˜**: å¤é€‰æ¡†UI+å¤šé€‰é€»è¾‘+æç¤ºä¿¡æ¯

**ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼** ğŸ‰

**é‡è¦**: 
- é‡å¯å¼€å‘æœåŠ¡å™¨
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- ç„¶åè®¿é—®æµ‹è¯•
