# ğŸ”§ æ•°æ®åº“è¿æ¥é—®é¢˜è¯Šæ–­ä¸è§£å†³æ–¹æ¡ˆ

## âŒ å½“å‰é—®é¢˜

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Can't reach database server at `db.rekdretiemtoofrvcils.supabase.co:5432`
```

**é—®é¢˜åŸå› **ï¼šæ— æ³•è¿æ¥åˆ° Supabase æ•°æ®åº“æœåŠ¡å™¨

---

## ğŸ” é—®é¢˜è¯Šæ–­

### å¯èƒ½çš„åŸå› 

1. **ç½‘ç»œè¿æ¥é—®é¢˜**
   - SupabaseæœåŠ¡å™¨åœ¨å›½å¤–ï¼Œå¯èƒ½éœ€è¦ä»£ç†
   - é˜²ç«å¢™é˜»æ­¢äº†è¿æ¥
   - ç½‘ç»œä¸ç¨³å®š

2. **æ•°æ®åº“é…ç½®é—®é¢˜**
   - æ•°æ®åº“åœ°å€é”™è¯¯
   - å¯†ç é”™è¯¯
   - æ•°æ®åº“æœªå¯åŠ¨æˆ–å·²æš‚åœ

3. **è¿æ¥å­—ç¬¦ä¸²æ ¼å¼é—®é¢˜**
   - DATABASE_URL æ ¼å¼ä¸æ­£ç¡®

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šéªŒè¯æ•°æ®åº“è¿æ¥ï¼ˆæ¨èä¼˜å…ˆå°è¯•ï¼‰

#### æ­¥éª¤1ï¼šç™»å½• Supabase æ§åˆ¶å°
1. è®¿é—®ï¼šhttps://supabase.com/dashboard
2. ç™»å½•æ‚¨çš„è´¦å·
3. é€‰æ‹©æ‚¨çš„é¡¹ç›®ï¼š`rekdretiemtoofrvcils`

#### æ­¥éª¤2ï¼šæ£€æŸ¥æ•°æ®åº“çŠ¶æ€
- ç¡®è®¤é¡¹ç›®çŠ¶æ€ä¸º **Active**
- å¦‚æœæ˜¯ **Paused**ï¼Œç‚¹å‡» **Restore** æ¢å¤

#### æ­¥éª¤3ï¼šè·å–æ­£ç¡®çš„è¿æ¥å­—ç¬¦ä¸²
1. åœ¨ Supabase æ§åˆ¶å°ï¼Œç‚¹å‡» **Settings** â†’ **Database**
2. æ‰¾åˆ° **Connection String** â†’ **URI**
3. é€‰æ‹© **Transaction Mode**ï¼ˆæ¨èï¼‰æˆ– **Session Mode**
4. å¤åˆ¶è¿æ¥å­—ç¬¦ä¸²ï¼Œæ ¼å¼ç±»ä¼¼ï¼š
   ```
   postgresql://postgres.[é¡¹ç›®å]:[å¯†ç ]@aws-0-[region].pooler.supabase.com:5432/postgres
   ```

#### æ­¥éª¤4ï¼šæ›´æ–°ç¯å¢ƒå˜é‡
æ‰“å¼€ `.env.local` å’Œ `.env` æ–‡ä»¶ï¼Œæ›¿æ¢ä¸ºæ­£ç¡®çš„è¿æ¥å­—ç¬¦ä¸²ï¼š
```env
DATABASE_URL="åˆšæ‰å¤åˆ¶çš„æ­£ç¡®è¿æ¥å­—ç¬¦ä¸²"
```

---

### æ–¹æ¡ˆ2ï¼šæµ‹è¯•æ•°æ®åº“è¿æ¥

åˆ›å»ºæµ‹è¯•è„šæœ¬ `test-db-connection.ts`ï¼š

```typescript
import { PrismaClient } from '@prisma/client';
import { config } from 'dotenv';

config({ path: '.env.local' });

const prisma = new PrismaClient();

async function testConnection() {
  console.log('ğŸ” æµ‹è¯•æ•°æ®åº“è¿æ¥...\n');
  console.log(`DATABASE_URL: ${process.env.DATABASE_URL?.substring(0, 50)}...\n`);
  
  try {
    await prisma.$connect();
    console.log('âœ… æ•°æ®åº“è¿æ¥æˆåŠŸï¼\n');
    
    // æµ‹è¯•æŸ¥è¯¢
    const result = await prisma.$queryRaw`SELECT version()`;
    console.log('ğŸ“Š æ•°æ®åº“ç‰ˆæœ¬:', result);
    
    // æŸ¥è¯¢ç°æœ‰è¡¨
    const tables = await prisma.$queryRaw`
      SELECT table_name 
      FROM information_schema.tables 
      WHERE table_schema = 'public'
    `;
    console.log('\nğŸ“‹ ç°æœ‰æ•°æ®è¡¨:', tables);
    
  } catch (error) {
    console.error('âŒ æ•°æ®åº“è¿æ¥å¤±è´¥:', error);
  } finally {
    await prisma.$disconnect();
  }
}

testConnection();
```

è¿è¡Œæµ‹è¯•ï¼š
```bash
npx tsx test-db-connection.ts
```

---

### æ–¹æ¡ˆ3ï¼šä½¿ç”¨ä»£ç†è¿æ¥ï¼ˆå¦‚æœæ˜¯ç½‘ç»œé—®é¢˜ï¼‰

å¦‚æœæ‚¨åœ¨ä¸­å›½å¤§é™†ï¼Œå¯èƒ½éœ€è¦é…ç½®ä»£ç†ï¼š

#### æ–¹æ³•Aï¼šè®¾ç½®ç³»ç»Ÿä»£ç†
```bash
# PowerShell
$env:HTTP_PROXY="http://127.0.0.1:7890"
$env:HTTPS_PROXY="http://127.0.0.1:7890"

# ç„¶åè¿è¡Œ Prisma å‘½ä»¤
npx prisma db push
```

#### æ–¹æ³•Bï¼šä½¿ç”¨ Supabase CLI
```bash
# å®‰è£… Supabase CLI
npm install -g supabase

# ç™»å½•
supabase login

# é“¾æ¥é¡¹ç›®
supabase link --project-ref rekdretiemtoofrvcils
```

---

### æ–¹æ¡ˆ4ï¼šä½¿ç”¨ Supabase REST API ç›´æ¥å¯¼å…¥

å¦‚æœ Prisma è¿æ¥æœ‰é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ Supabase çš„ REST APIï¼š

```typescript
// import-via-api.ts
const SUPABASE_URL = 'https://rekdretiemtoofrvcils.supabase.co';
const SUPABASE_ANON_KEY = 'æ‚¨çš„anon key';

const questions = [/* é¢˜ç›®æ•°æ® */];

async function importViaAPI() {
  for (const question of questions) {
    const response = await fetch(`${SUPABASE_URL}/rest/v1/questions`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'apikey': SUPABASE_ANON_KEY,
        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
        'Prefer': 'return=representation'
      },
      body: JSON.stringify(question)
    });
    
    if (response.ok) {
      console.log('âœ… å¯¼å…¥æˆåŠŸ');
    } else {
      console.error('âŒ å¯¼å…¥å¤±è´¥:', await response.text());
    }
  }
}

importViaAPI();
```

---

### æ–¹æ¡ˆ5ï¼šæš‚æ—¶ä½¿ç”¨æœ¬åœ°æ•°æ®åº“å¼€å‘

å¦‚æœ Supabase è¿æ¥ä¸€ç›´æœ‰é—®é¢˜ï¼Œå¯ä»¥å…ˆç”¨æœ¬åœ° PostgreSQLï¼š

#### æ­¥éª¤1ï¼šå®‰è£… PostgreSQLï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
- ä¸‹è½½ï¼šhttps://www.postgresql.org/download/
- æˆ–ä½¿ç”¨ Dockerï¼š
  ```bash
  docker run --name postgres-dev -e POSTGRES_PASSWORD=password -p 5432:5432 -d postgres
  ```

#### æ­¥éª¤2ï¼šæ›´æ–°è¿æ¥å­—ç¬¦ä¸²
```env
DATABASE_URL="postgresql://postgres:password@localhost:5432/medexam_dev"
```

#### æ­¥éª¤3ï¼šæ¨é€æ•°æ®åº“ç»“æ„
```bash
npx prisma db push
```

#### æ­¥éª¤4ï¼šå¯¼å…¥æ•°æ®
```bash
npx tsx prisma/import-2024-zhongyao.ts
```

---

## ğŸ“ æ£€æŸ¥æ¸…å•

è¯·æŒ‰é¡ºåºæ£€æŸ¥ï¼š

- [ ] 1. ç™»å½• Supabase æ§åˆ¶å°ï¼Œç¡®è®¤é¡¹ç›®çŠ¶æ€ä¸º Active
- [ ] 2. ä» Supabase è·å–æœ€æ–°çš„è¿æ¥å­—ç¬¦ä¸²
- [ ] 3. æ›´æ–° `.env.local` å’Œ `.env` æ–‡ä»¶
- [ ] 4. è¿è¡Œ `npx tsx test-db-connection.ts` æµ‹è¯•è¿æ¥
- [ ] 5. å¦‚æœè¿æ¥æˆåŠŸï¼Œè¿è¡Œ `npx prisma db push` æ¨é€æ•°æ®åº“ç»“æ„
- [ ] 6. è¿è¡Œ `npx tsx prisma/import-2024-zhongyao.ts` å¯¼å…¥æ•°æ®

---

## ğŸ†˜ å¦‚æœä»ç„¶æ— æ³•è§£å†³

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥å¸®åŠ©ï¼š

1. Supabase é¡¹ç›®çŠ¶æ€æˆªå›¾
2. è¿è¡Œ `npx tsx test-db-connection.ts` çš„å®Œæ•´è¾“å‡º
3. æ‚¨çš„ç½‘ç»œç¯å¢ƒï¼ˆæ˜¯å¦åœ¨ä¸­å›½å¤§é™†ï¼Ÿæ˜¯å¦ä½¿ç”¨ä»£ç†ï¼Ÿï¼‰
4. é”™è¯¯çš„å®Œæ•´å †æ ˆä¿¡æ¯

---

## ğŸ’¡ ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šå‰ç«¯ä½¿ç”¨ Mock æ•°æ®

åœ¨æ•°æ®åº“é—®é¢˜è§£å†³ä¹‹å‰ï¼Œå¯ä»¥å…ˆåœ¨å‰ç«¯ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æµ‹è¯•ï¼š

```typescript
// lib/mock-data.ts
export const mockQuestions = [
  {
    id: 'mock-1',
    examType: 'æ‰§ä¸šè¯å¸ˆ',
    subject: 'ä¸­è¯å­¦ç»¼åˆçŸ¥è¯†ä¸æŠ€èƒ½',
    chapter: 'ä¸­åŒ»åŸºç¡€ç†è®º',
    questionType: 'single',
    content: 'å±äº"é˜³è„‰ä¹‹æµ·"çš„æ˜¯',
    options: [
      { key: 'A', value: 'é˜³ç»´ä¹‹è„‰' },
      { key: 'B', value: 'é˜³è··ä¹‹è„‰' },
      { key: 'C', value: 'ç£è„‰' },
      { key: 'D', value: 'å¸¦è„‰' },
      { key: 'E', value: 'ä»»è„‰' }
    ],
    correctAnswer: 'C',
    explanation: 'ç£è„‰ä¸º"é˜³è„‰ä¹‹æµ·"ã€‚ä»»è„‰ä¸º"é˜´è„‰ä¹‹æµ·"ã€‚',
    difficulty: 2,
    knowledgePoints: ['ç»ç»œå­¦è¯´', 'é«˜é¢‘è€ƒç‚¹'],
    isPublished: true,
    viewCount: 0,
    correctCount: 0,
    answerCount: 0,
    createdAt: new Date(),
    updatedAt: new Date()
  },
  // æ·»åŠ æ›´å¤šmockæ•°æ®...
];
```

åœ¨ API ä¸­ä½¿ç”¨ï¼š
```typescript
// app/api/questions/route.ts
import { mockQuestions } from '@/lib/mock-data';

export async function GET(request: NextRequest) {
  // ä¸´æ—¶è¿”å› mock æ•°æ®
  return NextResponse.json({
    success: true,
    data: {
      questions: mockQuestions,
      total: mockQuestions.length
    }
  });
}
```

---

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼šè¯·å…ˆå°è¯•æ–¹æ¡ˆ1ï¼Œä» Supabase æ§åˆ¶å°è·å–æ­£ç¡®çš„è¿æ¥å­—ç¬¦ä¸²ï¼
