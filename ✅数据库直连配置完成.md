# âœ… Supabase tiku2 æ•°æ®åº“ç›´è¿é…ç½®å®Œæˆ

## ğŸ“Š é…ç½®æ€»ç»“

### ğŸ¯ é¡¹ç›®ä¿¡æ¯
- **é¡¹ç›®åç§°**: tiku2
- **é¡¹ç›® ID**: tparjdkxxtnentsdazfw
- **æ•°æ®åº“åŒºåŸŸ**: us-west-2 (ç¾å›½è¥¿éƒ¨)
- **æ•°æ®åº“ç‰ˆæœ¬**: PostgreSQL 17.6

### âœ… è¿æ¥æ–¹å¼
ç»è¿‡æµ‹è¯•ï¼Œä»¥ä¸‹è¿æ¥æ–¹å¼å¯ç”¨ï¼š

1. âœ… **Session Pooler** (æ¨è) - ç«¯å£ 5432
   - æœ€é€‚åˆ Prisma ORM
   - æ”¯æŒé•¿è¿æ¥å’Œäº‹åŠ¡
   - å·²é…ç½®å¹¶æµ‹è¯•æˆåŠŸ

2. âœ… **Transaction Pooler** - ç«¯å£ 6543
   - é€‚åˆé«˜å¹¶å‘åœºæ™¯
   - æµ‹è¯•æˆåŠŸ

3. âŒ **Direct Connection** - ç«¯å£ 5432
   - DNS è§£æå¤±è´¥
   - å¯èƒ½æ˜¯ç½‘ç»œæˆ–é˜²ç«å¢™é™åˆ¶

4. âœ… **Supabase API** (HTTPS)
   - é€šè¿‡ REST API è®¿é—®
   - ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ

### ğŸ“ ç¯å¢ƒå˜é‡é…ç½®

å·²åˆ›å»ºçš„æ–‡ä»¶ï¼š
- `.env` - Prisma ä½¿ç”¨
- `.env.local` - Next.js å¼€å‘ç¯å¢ƒä½¿ç”¨

é…ç½®å†…å®¹ï¼š
```env
DATABASE_URL="postgresql://postgres.tparjdkxxtnentsdazfw:CwKXguB7eIA4tfTn@aws-0-us-west-2.pooler.supabase.com:5432/postgres"
NEXT_PUBLIC_SUPABASE_URL="https://tparjdkxxtnentsdazfw.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRwYXJqZGt4eHRuZW50c2RhemZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxODEwMzgsImV4cCI6MjA3ODc1NzAzOH0.2P5_CUnHErcTTTC2-LZo1tqFaq0ps0g-kpglqS45Y5s"
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="medexam-pro-secret-key-change-in-production"
```

### ğŸ“Š æ•°æ®åº“ç°çŠ¶

#### è¡¨ç»“æ„ (13ä¸ªåº”ç”¨è¡¨)
1. **ai_generated_questions** - AI ç”Ÿæˆçš„é¢˜ç›® (13åˆ—)
2. **daily_stats** - æ¯æ—¥ç»Ÿè®¡ (10åˆ—)
3. **institutions** - åŸ¹è®­æœºæ„ (12åˆ—)
4. **knowledge_points** - çŸ¥è¯†ç‚¹ (14åˆ—)
5. **pdf_resources** - PDF èµ„æº (20åˆ—)
6. **prediction_papers** - æŠ¼é¢˜è¯•å· (17åˆ—)
7. **questions** - é¢˜ç›® (21åˆ—) â­ å·²æœ‰10æ¡æ•°æ®
8. **study_plans** - å­¦ä¹ è®¡åˆ’ (13åˆ—)
9. **system_configs** - ç³»ç»Ÿé…ç½® (4åˆ—)
10. **user_answers** - ç”¨æˆ·ç­”é¢˜è®°å½• (8åˆ—)
11. **user_assessments** - ç”¨æˆ·æµ‹è¯„ (15åˆ—)
12. **user_profiles** - ç”¨æˆ·èµ„æ–™ (17åˆ—)
13. **wrong_questions** - é”™é¢˜æœ¬ (9åˆ—)

å¦å¤–è¿˜æœ‰ Supabase çš„ auth schemaï¼ˆ19ä¸ªè®¤è¯ç›¸å…³è¡¨ï¼‰ã€‚

#### ç°æœ‰æ•°æ®
- **é¢˜ç›®**: 10 é“
- **ç¬¬ä¸€æ¡é¢˜ç›®**: 
  - ID: 2024_zyyz_001
  - è€ƒè¯•ç±»å‹: æ‰§ä¸šè¯å¸ˆ
  - ç§‘ç›®: ä¸­è¯å­¦ç»¼åˆçŸ¥è¯†ä¸æŠ€èƒ½
  - é¢˜å‹: å•é€‰é¢˜

### ğŸ› ï¸ Prisma é…ç½®

#### schema.prisma æ›´æ–°
```prisma
generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public", "auth"]
}
```

- âœ… å¯ç”¨ `multiSchema` æ”¯æŒ
- âœ… é…ç½® `public` å’Œ `auth` schema
- âœ… ä»æ•°æ®åº“æ‹‰å–å®é™…è¡¨ç»“æ„
- âœ… ç”Ÿæˆ Prisma Client

### ğŸ§ª æµ‹è¯•ç»“æœ

æ‰€æœ‰æµ‹è¯•å‡é€šè¿‡ï¼š
- âœ… æ•°æ®åº“è¿æ¥æµ‹è¯•
- âœ… Session Pooler è¿æ¥æµ‹è¯•
- âœ… Transaction Pooler è¿æ¥æµ‹è¯•
- âœ… Prisma Client æŸ¥è¯¢æµ‹è¯•
- âœ… è¯»å†™æƒé™æµ‹è¯•

### ğŸ“ åˆ›å»ºçš„å·¥å…·æ–‡ä»¶

1. **test-all-connections.ts** - å®Œæ•´è¿æ¥æµ‹è¯•
2. **test-supabase-pooler.ts** - è¿æ¥æ± æµ‹è¯•
3. **test-prisma-queries.ts** - Prisma æŸ¥è¯¢æµ‹è¯•
4. **diagnose-network.ts** - ç½‘ç»œè¯Šæ–­å·¥å…·
5. **verify-database.ts** - æ•°æ®åº“éªŒè¯è„šæœ¬
6. **.env.local.template** - ç¯å¢ƒå˜é‡æ¨¡æ¿
7. **setup-database.bat** - é…ç½®å‘å¯¼

## ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```

### 2. è®¿é—®åº”ç”¨
```
http://localhost:3000
```

### 3. å¦‚éœ€é‡æ–°åŒæ­¥ schema
```bash
# ä»æ•°æ®åº“æ‹‰å–æœ€æ–°ç»“æ„
npx prisma db pull

# ç”Ÿæˆ Prisma Client
npm run db:generate
```

### 4. å¦‚éœ€åˆ›å»ºæ–°è¡¨æˆ–ä¿®æ”¹ç»“æ„
```bash
# ä¿®æ”¹ prisma/schema.prisma åæ‰§è¡Œ
npm run db:push
```

## âš ï¸ é‡è¦æç¤º

1. **å¯†ç å®‰å…¨**: 
   - `.env` å’Œ `.env.local` å·²æ·»åŠ åˆ° `.gitignore`
   - ä¸è¦å°†å¯†ç æäº¤åˆ° Git

2. **ç”Ÿäº§ç¯å¢ƒ**:
   - ç”Ÿäº§ç¯å¢ƒéœ€è¦æ›´æ”¹ `NEXTAUTH_SECRET`
   - å»ºè®®ä½¿ç”¨ Vercel ç¯å¢ƒå˜é‡ç®¡ç†

3. **è¿æ¥é™åˆ¶**:
   - Session Pooler é€‚åˆå¼€å‘å’Œç”Ÿäº§
   - æ³¨æ„ Supabase å…è´¹ç‰ˆçš„è¿æ¥æ•°é™åˆ¶

4. **æ•°æ®å¤‡ä»½**:
   - å®šæœŸå¤‡ä»½é‡è¦æ•°æ®
   - å¯ä»¥ä½¿ç”¨ Supabase Dashboard çš„å¤‡ä»½åŠŸèƒ½

## ğŸ“š å‚è€ƒé“¾æ¥

- [Supabase Dashboard](https://supabase.com/dashboard/project/tparjdkxxtnentsdazfw)
- [Prisma æ–‡æ¡£](https://www.prisma.io/docs)
- [Supabase æ–‡æ¡£](https://supabase.com/docs)

## âœ¨ é…ç½®å®Œæˆæ—¶é—´

**2024-11-18 14:22 (UTC+08:00)**

---

ğŸ‰ æ­å–œï¼ä½ çš„ Supabase tiku2 æ•°æ®åº“å·²æˆåŠŸé…ç½®å¹¶é€šè¿‡æ‰€æœ‰æµ‹è¯•ï¼
