# 🔍 前端看不到2024年真题 - 问题诊断与解决方案

## ❌ 根本原因

**前端使用的是模拟数据，未连接真实数据库API！**

查看文件 `app/practice/[mode]/page.tsx`，第 19-51 行：

```typescript
// 模拟题目数据
const mockQuestion = {
  id: "q1",
  examType: "执业药师",
  subject: "药学专业知识一",
  // ... 硬编码的模拟题目
};
```

**问题：**
- ❌ 前端直接使用硬编码的模拟题目
- ❌ 没有调用 `/api/questions` 接口
- ❌ 无法显示数据库中的真题（包括2024年真题）

## ✅ 解决方案

### 方案 1: 修改前端代码连接真实API（推荐）

需要修改 `app/practice/[mode]/page.tsx`，让它从API获取真实题目。

#### 修改步骤：

1. **添加API调用函数**
2. **使用真实数据替换模拟数据**
3. **添加筛选条件（可选择2024年真题）**

### 方案 2: 先验证数据库有题目

在修改前端前，先确认数据库中有数据。

## 🚀 立即修复步骤

### 步骤 1: 恢复 Supabase 项目并导入数据

```powershell
# 1. 访问 Supabase Dashboard
# https://supabase.com/dashboard/project/mjyfiryzawngzadfxfoe

# 2. 如果项目暂停，点击 "Resume Project" 恢复

# 3. 创建 .env.local 文件（根目录）
# 内容：
DATABASE_URL="postgresql://postgres:yZaNnwx8VfkVRVkk@db.rekdretiemtoofrvcils.supabase.co:5432/postgres"
NEXTAUTH_SECRET="change-this-secret-123456"
NEXTAUTH_URL="http://localhost:3000"

# 4. 同步数据库结构
npx prisma db push

# 5. 运行导入脚本（使用提供的批处理文件）
.\导入2024年真题.bat
```

### 步骤 2: 修复前端连接API

我将创建一个修复后的前端文件。

## 📊 数据库查询方式

### 查询所有2024年真题

```typescript
const questions = await prisma.question.findMany({
  where: {
    examType: '执业药师',
    subject: '中药学综合知识与技能',
    knowledgePoints: {
      has: '2024年真题'
    },
    isPublished: true,
  },
  orderBy: {
    createdAt: 'desc'
  }
});
```

### API调用示例

```typescript
// 前端调用
const response = await fetch('/api/questions?examType=执业药师&subject=中药学综合知识与技能');
const data = await response.json();
console.log('题目数量:', data.data.total);
console.log('题目列表:', data.data.questions);
```

## 🎯 完整修复流程

### 1. 数据库层面

- [x] 已创建数据库连接脚本 `setup-db-2024.ts`
- [ ] 需要先恢复 Supabase 项目
- [ ] 运行 `npx prisma db push` 创建表结构
- [ ] 运行 `npx tsx setup-db-2024.ts` 导入2024真题

### 2. API层面

- [x] API路由已存在 `app/api/questions/route.ts`
- [x] 支持按 `examType`、`subject`、`chapter` 筛选
- [ ] 可以添加按年份或标签筛选的功能

### 3. 前端层面

- [ ] 修改 `app/practice/[mode]/page.tsx` 
- [ ] 替换模拟数据为真实API调用
- [ ] 添加题目筛选选项（可选择2024年真题）
- [ ] 添加科目选择器（显示"中药学综合知识与技能"）

## 🔧 我可以帮你做的事情

### 选项 A：一键修复（推荐）

我可以创建：
1. ✅ 修复后的前端文件（连接真实API）
2. ✅ 数据导入脚本（已创建）
3. ✅ 批处理文件（已创建）

### 选项 B：手动修复

如果你想自己修改，需要：
1. 在 `app/practice/[mode]/page.tsx` 添加 `useEffect` 调用 API
2. 将 `mockQuestion` 替换为从 API 获取的数据
3. 添加加载状态和错误处理

### 选项 C：扩展现有数据

如果你有完整的120道2024年真题：
1. 提供Excel/CSV格式的题目数据
2. 我帮你创建批量导入脚本
3. 一次性导入所有题目

## 💡 推荐的筛选界面

前端可以添加：

```typescript
// 科目选择
const subjects = [
  '药学专业知识一',
  '药学专业知识二', 
  '药学综合知识与技能',
  '中药学专业知识一',
  '中药学专业知识二',
  '中药学综合知识与技能', // ← 2024年真题在这里
];

// 年份筛选
const years = [2024, 2023, 2022, 2021];

// 调用API时传递参数
const url = `/api/questions?examType=执业药师&subject=中药学综合知识与技能&limit=20`;
```

## 🚨 当前状态总结

| 组件 | 状态 | 说明 |
|------|------|------|
| 数据库 | ❌ 未连接 | Supabase项目可能暂停 |
| 数据表结构 | ❓ 未知 | 需要运行 prisma db push |
| 2024年真题数据 | ❌ 未导入 | 需要运行导入脚本 |
| API接口 | ✅ 已存在 | `/api/questions` 可用 |
| 前端页面 | ❌ 使用模拟数据 | 需要修改连接API |

## 📞 下一步行动

**请选择一个选项：**

### 选项 1：让我全部修复
我将：
1. 创建修复后的前端文件
2. 修改前端代码连接真实API
3. 添加2024年真题筛选功能
4. 提供完整的测试流程

### 选项 2：我自己修复
你需要：
1. 恢复 Supabase 项目
2. 运行 `.\导入2024年真题.bat`
3. 修改前端代码（参考上面的示例）
4. 重启开发服务器 `npm run dev`

### 选项 3：提供更多信息
如果你有：
- 完整的120道2024年真题数据
- Excel/Word/CSV格式的题目
- 其他年份的真题数据

我可以帮你批量导入所有题目。

---

**快速验证数据库是否有题目：**

```powershell
# 创建 .env.local 后运行
npx tsx test-db-connection.ts
```

看到题目数量 > 0，说明数据库有数据。
如果显示 0，需要先导入数据。
